/**
 * @fileOverview 企業情報画面の画面制御を定義するJSファイルです。
 * @name corpinfo.js
 */

// ブラウザ判定処理 IE4,NS4以降
var gIsOP6=0; // Opera6以降で1
var gIsIE5=0; // IE5.0以降で1
var gIsNS6=0; // Netscape6以降で1
var gIsFire=0; // FireFox

/**
 * <h2>処理概要</h2>
 * navigatorのappNameとappVersionを取得し、Netscape4.xか判定する.<br>
 * @return {Boolean} Netscape4.xの場合true、それ以外の場合false
 */
function lIsNS4ver()
{
	if(!navigator.appName || !navigator.appVersion) {
		return false;
	}
	return (navigator.appName=="Netscape" && navigator.appVersion.indexOf("4.")==0);
}

/**
 * <h2>処理概要</h2>
 * window情報およびUserAgent情報を取得し、ブラウザ判定処理 IE4,NS4以降か判定する.<br>
 * <h2>設定内容<h2>
 * gIsOP6  : window.operaがtrueで、document.getElementByIdが使用可能な場合1、それ以外の場合0
 * gIsIE5  : document.allが使用可能で、document.getElementByIdが使用可能な場合1、それ以外の場合0
 * gIsNS6  : document.addEventListenerが使用可能な場合1、それ以外の場合0
 * gIsFire : UserAgentに"Fire"が含まれている場合1、それ以外の場合0
 */
function uaIdentify()
{
	var lIsIE4=0;
	var lIsNS4=0;
	var lUa = navigator.userAgent;

	if(window.opera){
		if(document.getElementById){
			gIsOP6=1;
		}
	} else if(document.all){
		lIsIE4=1;
	} else if(lIsNS4ver()){
		lIsNS4=1;
	} else if(document.addEventListener){
		gIsNS6=1;
	}
	if(lIsIE4 && document.getElementById){
		gIsIE5=1;
	} else if(lUa.indexOf("Fire",0) >= 0){
		gIsFire=1;
	}
}

/**
 * <h2>処理概要</h2>
 * window.opernerから親画面の情報を取得し、親画面のドキュメントにアクセス可能かチェックする.<br>
 * @param {Object} aOpenerWindow windowオブジェクト
 * @return {Boolean} アクセス可能な場合false、アクセス不可能な場合true
 */
function noAccess(aOpenerWindow)
{
	var tcStr = "try{ aOpenerWindow.opener.document } catch (wodErr) { 0 }";
	if(gIsIE5 || gIsNS6 || gIsOP6 || gIsFire){
		if(!eval(tcStr)){
			return true;
		}
	} else {
		return true;
	}
	return(aOpenerWindow.opener.closed);
}

/**
 * <h2>処理概要</h2>
 * 「前の企業」リンク・「次の企業」リンクの表示制御を行う.<br>
 * <h2>事前条件</h2>
 * <pre>
 *   １．親画面が存在すること
 *   ２．親画面のForm名が"searchCorpListByGenCondForm"であること
 *   ３．親画面のオブジェクトにsearchIdAllListが存在すること
 *   ４．親画面のオブジェクトにsearchFlgが存在すること
 *   ５．親画面のオブジェクトにidListMaxが存在すること
 *   ６．親画面のオブジェクトにcursorが存在すること
 * </pre>
 */
function init()
{
	var lCur = 0;

	cancelSubmit();

	uaIdentify(); // ブラウザの判定

	if(!window.opener || noAccess(window)) {
		// 親ブラウザが存在しない場合
		// 何もしない
	} else {	// 親ブラウザが存在する場合
		var lFormObj = window.opener.document.getElementById("searchCorpListByGenCondForm");
		var lWinName = window.name;

		// 該当するFORMオブジェクトが存在する場合
		if(lFormObj) {

			// 親ブラウザから検索結果の企業IDリストを取得
			var lCorpObj = lFormObj.searchIdAllList;
			// 親ブラウザの更新フラグを取得
			var lSrchFlgObj = lFormObj.searchFlg;

			if(lSrchFlgObj && lSrchFlgObj.value == 1) {

				if(lCorpObj) {
					// 親ブラウザから検索結果件数を取得
					var lCorpMaxNum = lFormObj.idListMax.value;
					// 検索結果件数が存在する場合
					if(lCorpMaxNum) {
						// 企業の検索番号を取得
						lCur = lFormObj.cursor.value;
						// 検索結果件数を設定
						var lMaxNum = 0 + eval(lCorpMaxNum);
						// 検索番号が0以上の場合
						if(lCur - 1 >= 0){
							// 上部「前の企業」リンクを表示
							var lBackObj = document.getElementById("back");
							if(lBackObj) {
								lBackObj.style.visibility = "visible";
							}
							// 下部「前の企業」リンクを表示
							var lBackObj2 = document.getElementById("back2");
							if(lBackObj2) {
								lBackObj2.style.visibility = "visible";
							}
						}
						// 検索番号に+1した値が検索結果件数より小さい場合
						if(lMaxNum > lCur - 0 + 1){
							// 上部「次の企業」リンクを表示
							var lNextObj = document.getElementById("next");
							if(lNextObj) {
								lNextObj.style.visibility = "visible";
							}
							// 下部「次の企業」リンクを表示
							var lNextObj2 = document.getElementById("next2");
							if(lNextObj2) {
								lNextObj2.style.visibility = "visible";
							}
						}
						if(lWinName != "EntryWindow"){
							// 上部「前の企業」リンクを非表示
							var lBackObj = document.getElementById("back");
							if(lBackObj) {
								lBackObj.style.visibility = "hidden";
							}
							// 下部「前の企業」リンクを非表示
							var lBackObj2 = document.getElementById("back2");
							if(lBackObj2) {
								lBackObj2.style.visibility = "hidden";
							}
							// 上部「次の企業」リンクを非表示
							var lNextObj = document.getElementById("next");
							if(lNextObj) {
								lNextObj.style.visibility = "hidden";
							}
							// 下部「次の企業」リンクを非表示
							var lNextObj2 = document.getElementById("next2");
							if(lNextObj2) {
								lNextObj2.style.visibility = "hidden";
							}
						}
					}
				}
			}
		}
	}
}
