if(typeof(am)=="undefined"){var am={};}
am.Cache=Class.create();am.Cache.prototype={data:null,lastUpdate:null,initialize:function(){},empty:function(){return!Boolean(this.data);},clear:function(){if(this.data){delete this.data;}
this.data=null;if(this.lastUpdate){delete this.lastUpdate;}
this.lastUpdate=null;},set:function(data){this.clear();this.data=data;this.lastUpdate=new Date();},get:function(){return this.data;},getLastUpdate:function(){return(this.lastUpdate)?this.lastUpdate.getTime():0;}};am.AjaxCache=Class.create();Object.extend(am.AjaxCache.prototype,am.Cache.prototype);Object.extend(am.AjaxCache.prototype,{nowLoading:false,completeFunc:null,isNowLoading:function(){return this.nowLoading;},getURI:function(){alert("abstract");},getParameters:function(){alert("abstract");},onSuccess:function(request,header){this.set(request.responseText);(this.completeFunc||Prototype.emptyFunction)(this.get());this.nowLoading=false;},onFailure:function(request,header){(this.completeFunc||Prototype.emptyFunction)(null);this.nowLoading=false;},update:function(completeFunc){this.nowLoading=true;this.completeFunc=completeFunc;var uri=this.getURI();var opt={};opt.method="get";opt.parameters=$H(this.getParameters()).toQueryString();opt.asynchronous=true;opt.onSuccess=this.onSuccess.bind(this);opt.onFailure=this.onFailure.bind(this);var req=new Ajax.Request(uri,opt);}});am.XMLTreeCache=Class.create();Object.extend(am.XMLTreeCache.prototype,am.AjaxCache.prototype);Object.extend(am.XMLTreeCache.prototype,{onSuccess:function(request,header){try{this.set(request.responseXML);}catch(e){this.onFailure.apply(this,arguments);return;}
(this.completeFunc||Prototype.emptyFunction)(this.get());this.nowLoading=false;},getTreeNode:function(){return amtop.XMLUtil.selectFirst(this.get(),"//tree");},getNodeById:function(id){return amtop.XMLUtil.selectFirst(this.get(),"//item[@id='"+id+"']");},getAllNodes:function(){return amtop.XMLUtil.select(this.get(),"//item");}});am.MailFolderCache=Class.create();Object.extend(am.MailFolderCache.prototype,am.XMLTreeCache.prototype);Object.extend(am.MailFolderCache.prototype,{getURI:function(){return amdata.url.bin+"ammain/top_mailfolder";},getParameters:function(){var param={id:amdata.session.ID};if(Object.evalAmBoolean(amdata.sys.ENABLE_DISPLAYUNSEEN,amdata.usr.DISPLAY_UNSEEN)){param.unseen="on";}
if(((amtop.tabController.current=='home')||(amtop.tabController.current=='rmail'))&&(amtop.tabController.last=="")){param.login="on";}
return param;}});am.SaddrFolderCache=Class.create();Object.extend(am.SaddrFolderCache.prototype,am.XMLTreeCache.prototype);Object.extend(am.SaddrFolderCache.prototype,{onSuccess:function(request,header){try{this.set(request.responseXML);this.sourceText=request.responseText;}catch(e){this.onFailure.apply(this,arguments);return;}
(this.completeFunc||Prototype.emptyFunction)(this.get());this.nowLoading=false;},getTextSource:function(){return this.sourceText;},getURI:function(){return amdata.url.bin+"amaddr/addr_shared_folder";},getParameters:function(){var param={id:amdata.session.ID};return param;}});am.FileFolderCache=Class.create();Object.extend(am.FileFolderCache.prototype,am.XMLTreeCache.prototype);Object.extend(am.FileFolderCache.prototype,{getURI:function(){return amdata.url.bin+"amfile/folder_getlist";},getParameters:function(){var param={id:amdata.session.ID};return param;}});am.SaddrSuggestCache=Class.create();Object.extend(am.SaddrSuggestCache.prototype,am.AjaxCache.prototype);Object.extend(am.SaddrSuggestCache.prototype,{getURI:function(){return amdata.url.bin+"amcache/saddr.js";},getParameters:function(){var param={id:amdata.session.ID};return param;},onSuccess:function(request,header){try{var source=request.responseText;eval(source);this.set(sharedAddrbookListSource);delete sharedAddrbookListSource;}catch(e){this.onFailure.apply(this,arguments);return;}
(this.completeFunc||Prototype.emptyFunction)(this.get());this.nowLoading=false;}});am.MailFolderPulldownCache=Class.create();Object.extend(am.MailFolderPulldownCache.prototype,am.Cache.prototype);Object.extend(am.MailFolderPulldownCache.prototype,{maxLength:0,folder:null,handlerPattern:"//HANDLER//",template:"",results:null,initialize:function(folder,maxLength){am.Cache.prototype.initialize.apply(this,arguments);this.folder=folder;this.maxLength=maxLength;this.template=["<li><a href=\"javascript:"+this.handlerPattern+"(this, \'","","\');\" title=\"","","\"><img src=\""+amdata.url.image,"","\">","","</a>"];},update:function(){this.results=new Array();var tree=this.folder.getTreeNode();this.searchTree(tree.firstChild);this.results[0]="";this.results[this.results.length-1]="";this.set(this.results.join(""));delete this.results;this.results=null;},get:function(handlerName){if(this.folder.getLastUpdate()>this.getLastUpdate()){this.update();}
var handler=new RegExp(this.handlerPattern,"g");if(typeof(this.data)=="string"){return this.data.replace(handler,handlerName);}else{return"";}},searchTree:function(node){var items=amtop.XMLUtil.select(node,"item");var len=items.length;if(len>0){this.results.push("<ul>");var c,name;for(var i=0;i<len;i++){c=items[i];this.template[1]=c.getAttribute("id");this.template[5]=c.getAttribute("im0");name=c.getAttribute("name");if(this.maxLength&&(name.length>this.maxLength)){this.template[3]=name;this.template[7]=name.substr(0,this.maxLength)+"...";}else{this.template[3]="";this.template[7]=name;}
this.results.push(this.template.join(""));this.searchTree(c);this.results.push("</li>");}
this.results.push("</ul>");}}});am.SharedFolderPulldownCache=Class.create();Object.extend(am.SharedFolderPulldownCache.prototype,am.MailFolderPulldownCache.prototype);Object.extend(am.SharedFolderPulldownCache.prototype,{update:function(){this.results=new Array();var tree=this.folder.getTreeNode();var shared_node=this.folder.getNodeById("shared");if(shared_node){this.searchTree(shared_node);}
this.results[0]="";this.results[this.results.length-1]="";this.set(this.results.join(""));delete this.results;this.results=null;}});am.FileFolderPulldownCache=Class.create();Object.extend(am.FileFolderPulldownCache.prototype,am.Cache.prototype);Object.extend(am.FileFolderPulldownCache.prototype,{maxLength:0,folder:null,handlerPattern:"//HANDLER//",template:"",results:null,initialize:function(folder,maxLength){am.Cache.prototype.initialize.apply(this,arguments);this.folder=folder;this.maxLength=maxLength;this.template=["<li><a href=\"javascript:"+this.handlerPattern+"(this, \'","","\');\" title=\"","","\"><img src=\""+amdata.url.image,"","\">","","</a>"];},update:function(){this.results=new Array();var tree=this.folder.getTreeNode();this.searchTree(tree);this.results[0]="";this.results[this.results.length-1]="";this.set(this.results.join(""));delete this.results;this.results=null;},get:function(handlerName){if(this.folder.getLastUpdate()>this.getLastUpdate()){this.update();}
var handler=new RegExp(this.handlerPattern,"g");if(typeof(this.data)=="string"){return this.data.replace(handler,handlerName);}else{return"";}},searchTree:function(node){var items=amtop.XMLUtil.select(node,"item");var len=items.length;if(len>0){this.results.push("<ul>");var c,name;for(var i=0;i<len;i++){c=items[i];this.template[1]=c.getAttribute("id");this.template[5]=c.getAttribute("im0");name=c.getAttribute("name");if(this.maxLength&&(name.length>this.maxLength)){this.template[3]=name;this.template[7]=name.substr(0,this.maxLength)+"...";}else{this.template[3]="";this.template[7]=name;}
this.results.push(this.template.join(""));this.searchTree(c);this.results.push("</li>");}
this.results.push("</ul>");}}});am.TabController=Class.create({tabs:{},ready:false,last:'',current:'',initialize:function(tabs){for(i=0;i<tabs.length;i++){this.tabs[tabs[i]]=$(tabs[i]);}},select:function(tab){if(this.current!=tab){if(this.current!=""){this.last=this.current;this.tabs[this.current].className="unselected_tab";}
this.current=tab;this.tabs[this.current].className="selected_tab";}},lock:function(content_name){if(content_name&&this.current!=content_name){return;}
this.ready=false;},unlock:function(content_name){if(content_name&&this.current!=content_name){return;}
this.ready=true;}});am.ScrollNews=Class.create();am.ScrollNews.prototype={UP:0,DOWN:1,LEFT:2,RIGHT:3,NORMAL:0,ACCELERATE:1,ARC:2,SLEEPING:0,POLLING:1,SCROLLING:2,JOB_RESERVE_MAX:10,state:this.SLEEPING,currentContent:null,nextContent:null,autoScroll:false,enabled:true,emptyContent:null,timer:null,jobs:new Array,delta:0,basePoint:0,lastTimerFunc:null,lastTimerMsec:0,contentsArea:null,buttonPrev:null,buttonPrevDisabled:null,buttonNext:null,buttonNextDisabled:null,buttonStart:null,buttonStartDisabled:null,buttonStop:null,buttonStopDisabled:null,bindingArea:null,maxPage:null,currentPage:null,pagerArea:null,direction:this.UP,frequency:5000,speed:100,distance:30,increment:1,acceleration:2,mode:this.NORMAL,contentClassName:null,initialize:function(contentsArea,autoScroll,options){this.contentsArea=$(contentsArea);this.emptyContent=this.contentsArea.innerHTML;if(typeof(options)!="undefined"){this._initButton("buttonPrev",options.buttonPrev,this.scrollPrev);this._initButton("buttonNext",options.buttonNext,this.scrollNext);this._initButton("buttonStart",options.buttonStart,this.startAutoScroll);this._initButton("buttonStop",options.buttonStop,this.stopAutoScroll);var params=["buttonPrevDisabled","buttonNextDisabled","buttonStartDisabled","buttonStopDisabled","bindingArea","maxPage","currentPage","pagerArea"];this._setParams(options,params,true);params=["direction","frequency","speed","distance","increment","acceleration","mode","contentClassName"];this._setParams(options,params,false);if(this.bindingArea){Event.observe(this.bindingArea,"mouseover",this.pauseScroll.bindAsEventListener(this));Event.observe(this.bindingArea,"mouseout",this.resumeScroll.bindAsEventListener(this));}}
this.clear();if(Boolean(autoScroll)){this.startAutoScroll();}else{this.stopAutoScroll();}},_initButton:function(name,id,func){if(id){this[name]=$(id);Event.observe(this[name],"click",func.bindAsEventListener(this));}},_setParams:function(options,params,fl){var len=params.length;for(var i=0;i<len;i++){var key=params[i];if(options[key]){this[key]=(fl)?$(options[key]):options[key];}}},_displayElements:function(fl){for(var i=1;i<arguments.length;i++){if(arguments[i]){if(fl){Element.show(arguments[i]);}else{Element.hide(arguments[i]);}}}},append:function(content,fl){var el=document.createElement("span");el.innerHTML=content;Element.hide(el);el.style.position="absolute";if(this.contentClassName){Element.addClassName(el,this.contentClassName);}
this.contentsArea.appendChild(el);if(!fl){this._setMaxPage();}},set:function(contents){this.clear();var len=contents.length;for(var i=0;i<len;i++){this.append(contents[i],true);}
if(len>=1){this.show(0);this._setMaxPage();}},remove:function(index){this._stopPolling();try{var el=this.contentsArea.childNodes[index];this.contentsArea.removeChild(el);}catch(e){}
this._setMaxPage();this._resumePolling();},clear:function(){this._stopPolling();while(this.contentsArea.lastChild){this.contentsArea.removeChild(this.contentsArea.lastChild);}
this._setMaxPage(0);this._resumePolling();},_setMaxPage:function(max){if(typeof(max)=="undefined"){max=this.contentsArea.childNodes.length;}
if(this.maxPage){this.maxPage.innerHTML=max;}
if(this.enabled&&(max<2)){this._disableScroll();}else if(!this.enabled&&(max>=2)){this._enableScroll();}
if(max==0){this.contentsArea.innerHTML=this.emptyContent;if(this.currentPage){this.currentPage.innerHTML="0";}
if(this.pagerArea){Element.hide(this.pagerArea);}}else{if(this.pagerArea){Element.show(this.pagerArea);}}},_setCurrentPage:function(){if(this.currentPage){var cols=this.contentsArea.childNodes;var len=cols.length;var i;for(i=0;i<len;i++){if(cols[i]==this.currentContent){break;}}
this.currentPage.innerHTML=i+1;}},_enableScroll:function(){this.enabled=true;this._displayElements(false,this.buttonPrevDisabled,this.buttonNextDisabled,this.buttonStartDisabled,this.buttonStopDisabled,(this.autoScroll)?this.buttonStart:this.buttonStop);this._displayElements(true,this.buttonPrev,this.buttonNext,(this.autoScroll)?this.buttonStop:this.buttonStart);},_disableScroll:function(){this.enabled=false;this._displayElements(false,this.buttonPrev,this.buttonNext,this.buttonStart,this.buttonStop,(this.autoScroll)?this.buttonStartDisabled:this.buttonStopDisabled);this._displayElements(true,this.buttonPrevDisabled,this.buttonNextDisabled,(this.autoScroll)?this.buttonStopDisabled:this.buttonStartDisabled);},show:function(index){var el=this.contentsArea.childNodes[index];el.style.top="";el.style.left="";Element.show(el);this.currentContent=el;this._setCurrentPage();},_setTimer:function(func,msec){if(this.timer){clearTimeout(this.timer);this.timer=null;}
if(typeof(func)=="function"){this.timer=setTimeout(func,msec);this.lastTimerFunc=func;this.lastTimerMsec=msec;}else{this.lastTimerFunc=null;this.lastTimerMsec=0;}},pauseScroll:function(){if(this.timer){clearTimeout(this.timer);this.timer=null;}},resumeScroll:function(){if(this.lastTimerFunc){this.timer=setTimeout(this.lastTimerFunc,this.lastTimerMsec);}},startAutoScroll:function(){this.autoScroll=true;this._displayElements(false,(this.enabled)?this.buttonStart:this.buttonStartDisabled);this._displayElements(true,(this.enabled)?this.buttonStop:this.buttonStopDisabled);if(this.state!=this.SCROLLING){this._startPolling();}},stopAutoScroll:function(){this.autoScroll=false;this._displayElements(true,(this.enabled)?this.buttonStart:this.buttonStartDisabled);this._displayElements(false,(this.enabled)?this.buttonStop:this.buttonStopDisabled);if(this.state!=this.SCROLLING){this._stopPolling();}},_resumePolling:function(){if(this.autoScroll){this._startPolling();}else{this._stopPolling();}},_startPolling:function(){this.state=this.POLLING;this._setTimer(this._poll.bind(this),this.frequency);},_stopPolling:function(){this.state=this.SLEEPING;this._setTimer(null);},_poll:function(){if(this.jobs.length==0){this.jobs.push(1);}
this._work();},scrollPrev:function(){this._scrollTo(-1);},scrollNext:function(){this._scrollTo(1);},_scrollTo:function(inc){if(this.jobs.length<this.JOB_RESERVE_MAX){this.jobs.push(inc);if(this.state!=this.SCROLLING){this._setTimer(null);this._work();}}},_work:function(){if(this.enabled&&(this.jobs.length>=1)){this._beginScroll(this.jobs.shift());}else{this.jobs.clear();this._resumePolling();}},_beginScroll:function(inc){this.state=this.SCROLLING;var next;if(inc<0){if(this.currentContent==this.contentsArea.firstChild){next=this.contentsArea.lastChild;}else{next=this.currentContent.previousSibling;}
this.basePoint=-1*this.distance;}else{if(this.currentContent==this.contentsArea.lastChild){next=this.contentsArea.firstChild;}else{next=this.currentContent.nextSibling;}
this.basePoint=this.distance;}
switch(this.direction){case this.RIGHT:this.basePoint=-1*this.basePoint;case this.LEFT:next.style.top="0px";next.style.left=this.basePoint+"px";break;case this.DOWN:this.basePoint=-1*this.basePoint;case this.UP:default:next.style.top=this.basePoint+"px";next.style.left="0px";break;}
this.delta=0;this.currentContent.style.top="0px";this.currentContent.style.left="0px";Element.show(next);this.nextContent=next;this._setTimer(this._doScroll.bind(this),this.speed);},_doScroll:function(){var move;var end=false;switch(this.mode){case this.ACCELERATE:if(this.delta==0){this.delta=this.increment;}else{this.delta=this.delta*this.acceleration;}
move=this.delta;if(move>=this.distance){end=true;}
break;case this.ARC:this.delta=this.delta+this.increment;var r=this.distance/2;var cos=r*Math.cos(this.delta/180*Math.PI);move=-1*(cos-r);if(this.delta>=180){end=true;}
break;case this.NORMAL:default:this.delta=this.delta+this.increment;move=this.delta;if(move>=this.distance){end=true;}
break;}
if(end){this._endScroll();}else{var key;if((this.direction==this.RIGHT)||(this.direction==this.LEFT)){key="left";}else{key="top";}
if(this.basePoint>0){move=-1*move;}
this.currentContent.style[key]=move+"px";this.nextContent.style[key]=(this.basePoint+move)+"px";this._setTimer(this._doScroll.bind(this),this.speed);}},_endScroll:function(){Element.hide(this.currentContent);this.currentContent.style.top="";this.currentContent.style.left="";this.nextContent.style.top="";this.nextContent.style.left="";this.currentContent=this.nextContent;this.nextContent=null;this._setCurrentPage();this._work();},isOnAutoScroll:function(){return this.autoScroll;}};am.LoadStatus=Class.create();am.LoadStatus.prototype={el:null,images:null,labels:null,initialize:function(id,images,labels){this.el=$(id);this.images=images;this.labels=labels;this.set(1);},set:function(level){level=parseInt(level)-1;if(level<0){level=0;}else if(9<level){level=9;}
var label;if(level<4){label=0;}else if((4<=level)&&(level<8)){label=1;}else{label=2;}
this.el.innerHTML="<img class=\"icon\" src=\""+
amdata.url.image+this.images[level]+"\" alt=\""+this.labels[label]+"\" title=\""+this.labels[label]+"\">";}};am.FolderUnseen=Class.create({initialize:function(){},isEnable:function(force){if(!Object.evalAmBoolean(amdata.sys.ENABLE_DISPLAYUNSEEN,amdata.usr.DISPLAY_UNSEEN)){return false;}
if(!force&&(!Object.evalAmBoolean(amdata.sys.ENABLE_AUTO_UPDATEUNSEEN))){return false;}
return true;},updateAllFolder:function(resource,force){if(!resource){return;}
if(!this.isEnable(force)){return;}
if(amtop.tabController.current=="rmail"&&amtop.contents.mailFolder){if(amtop.contents.mailFolder.treeReady){amtop.contents.mailFolder.updateUnseenAll(resource);}else{setTimeout(function(){this.updateAllFolder.apply(this,[resource,force])}.bind(this),100);}}},resourceUpdate:function(resource,hash,unseen){if(!resource){resource={};}
if(!resource[hash]){resource[hash]={};}
resource[hash].unseen=unseen;return resource;}});am.RecentNote=Class.create({initialize:function(params){for(var key in params){this[key]=params[key];}
this.statusInit();},statusInit:function(){this.status={Default:true,Processing:false,Stop:false};},setSlideTitle:function(){var title=this.slide.recentTitle;this.slide.recentTitle=title.substring(2,title.length)+title.substring(0,2);document.title=this.slide.recentTitle;var tab=this.slide.tab;var idx=this.slide.order;tab.style.backgroundColor=this.slide.style[idx].bg;tab.style.color=this.slide.style[idx].fnt;this.slide.order=idx?0:1;},setDefaultTitle:function(){document.title=this.slide.defaultTitle;var tab=this.slide.tab;tab.style.backgroundColor="";tab.style.color="";},onSlideProcess:function(){this.setSlideTitle();if(!this.status.Stop){this.timer=setTimeout(this.onSlideProcess.bind(this),700);}else{this.onSlideStop();}},onSlideStop:function(){if(this.timer){clearTimeout(this.timer);}
this.setDefaultTitle();this.statusInit();},getStatus:function(state){return this.status[state];},onPopup:function(){var ret=null;if(!this.popup.windowname||!this.popup.winobj){ret=amtop.openRecent();}else{ret=amtop.openRecent(this.popup.winobj,this.popup.windowname);}
if(ret){this.popup.windowname=ret.window_name;this.popup.winobj=ret.winobj;}},isEnable:function(){if(!Object.evalAmBoolean(amdata.sys.ENABLE_AUTO_UPDATERECENT)){return false;}
return true;},Start:function(resource){if(this.status.Processing&&this.status.Processing!="popup"){return;}
if(!resource){return;}
if(!this.isEnable()){return;}
this.status.Default=false;if(resource.num>0){switch(amdata.usr.RECENT_NOTE_TYPE){case"alrt":if(this.alrt){this.status.Processing="alrt";alert(this.alrt.msg);}
this.statusInit();break;case"popup":if(this.popup){this.status.Processing="popup";this.onPopup();}
break;case"slide":if(this.slide){this.status.Processing="slide";this.slide.order=1;this.onSlideProcess();}
break;case"no":default:this.statusInit();break;}}},Stop:function(){if(this.status.Processing){this.status.Stop=true;}
if(this.status.Processing=="popup"){this.statusInit();delete(this.popup.windowname);delete(this.popup.winobj);}}});am.InfoUpdater=Class.create();am.InfoUpdater.prototype={timer:null,el:null,frequency:null,scrollNews:null,loadStatus:null,completeFunc:null,failureFunc:null,stopRecent:null,initialize:function(id,options){this.el=$(id);var params=["frequency","scrollNews","loadStatus","completeFunc","failureFunc","folderUnseen","recentNote"];var len=params.length;for(var i=0;i<len;i++){var key=params[i];if(options[key]){this[key]=options[key];}}
this.stopRecent=this.stopRecentNote.bind(this);},setTimer:function(func,msec){if(this.timer){clearTimeout(this.timer);this.timer=null;}
if(typeof(func)=="function"){this.timer=setTimeout(func,msec);}},timerReset:function(){this.setTimer(this.onProcess.bind(this),this.frequency);},start:function(updateNow){this.setTimer(this.onProcess.bind(this),(updateNow)?10:this.frequency);},stop:function(){this.setTimer(null);},onProcess:function(){if(this.updating){this.timerReset();return;}
if(this.scrollNews||this.loadStatus||Object.evalAmBoolean(amdata.sys.ENABLE_CHECKUNSEEN,amdata.usr.CHECKUNSEEN)){this.update();}
this.timerReset();},stopUpdateUnseen:function(){this._stopUpdateUnseen=true;},update:function(manual){if(this.updating){return;}
this.updating=true;this._stopUpdateUnseen=false;var uri=amdata.url.bin+"ammain/top_info_update";var opt={};opt.method="get";opt.parameters=$H({id:amdata.session.ID,ajax:"on",autoupdate:manual?"off":"on"}).toQueryString();opt.asynchronous=true;opt.evalScripts=true;opt.onFailure=this.onFailure.bind(this);var req=new Ajax.Updater(this.el,uri,opt);},getUnseenResource:function(){return this.unseenResource;},updateUnseenResource:function(hash,unseen){if(this.folderUnseen){this.unseenResource=this.folderUnseen.resourceUpdate(this.unseenResource,hash,unseen);}
return this.unseenResource;},stopRecentNote:function(){if(!amtop.initialStopRecentCancel){amtop.initialStopRecentCancelable=false;this.recentNote.Stop();}else{amtop.initialStopRecentCancel=false;amtop.initialStopRecentCancelable=true;}},stopRecentNoteIfAtLogin:function(){if(!amtop.initialStopRecentCancel&&amtop.initialStopRecentCancelable){amtop.initialStopRecentCancelable=false;this.recentNote.Stop();}},onComplete:function(unseen_update){if(this.folderUnseen&&!this._stopUpdateUnseen){this.folderUnseen.updateAllFolder(this.unseenResource,unseen_update);}
if(this.onceComplete){this.onceComplete();delete(this.onceComplete);}
if(unseen_update){this.updating=false;this.timerReset();return;}
this.infoLoad();(this.completeFunc||Prototype.emptyFunction)();this.updating=false;},infoLoad:function(){if(this.scrollNews){this.scrollNews.set(this.receivedNews);}
if(this.loadStatus){this.loadStatus.set(this.receivedLoadStatus);}
if(this.recentNote){this.recentNote.Start(this.recentResource);}},onFailure:function(){(this.failureFunc||Prototype.emptyFunction)();this.updating=false;}};am.RecentUpdater=Class.create(am.InfoUpdater,{onProcess:function(){if(this.updating){this.timerReset();return;}
if(Object.evalAmBoolean(amdata.sys.ENABLE_AUTO_UPDATERECENT)&&amdata.usr.RECENT_NOTE_TYPE!="no"){this.update();}
this.timerReset();},update:function(manual){if(this.updating){return;}
this.updating=true;var uri=amdata.url.bin+"ammain/top_recent_update";var opt={};opt.method="get";opt.parameters=$H({id:amdata.session.ID,ajax:"on"}).toQueryString();opt.asynchronous=true;opt.evalScripts=true;opt.onFailure=this.onFailure.bind(this);var req=new Ajax.Updater(this.el,uri,opt);}});am.UserDate=Class.create();am.UserDate.prototype={now:null,clock:null,clockFormat:"%Y/%m/%d %H:%M",frequency:1000,gmtOffset:0,timezone:null,tzName:null,previousDrawTime:-1,initialize:function(options){var params=["clock","clockFormat","frequency","gmtOffset","timezone","tzName"];var len=params.length;for(var i=0;i<len;i++){var key=params[i];if(options[key]){this[key]=options[key];}}
if(this.clock){this.clock=$(this.clock);}
this.update();},update:function(){if(this.now){delete this.now;}
this.now=new Date();this.now.setTime(this.now.getTime()+
(this.now.getTimezoneOffset()*60*1000)+
(this.gmtOffset*1000));if(this.clock){var min=this.now.getMinutes();if(min!=this.previousDrawTime){this.drawClock();this.previousDrawTime=min;}}
setTimeout(this.update.bind(this),this.frequency);},drawClock:function(){var tip="";if(this.tzName){tip=" ("+this.tzName+")";}else if(this.timezone){tip=" (GMT "+this.timezone+")";}
tip=tip.escapeHTML();var datetime=this.toString(this.clockFormat);datetime=datetime.escapeHTML();this.clock.setAttribute("title",datetime+tip);this.clock.innerHTML=datetime;},toString:function(format,src){if(typeof(src)=="undefined"){src=this.now;}
if(typeof(src)!="object"){return this.makeString.apply(this,arguments);}else{return this.makeString(format,src.getFullYear(),(src.getMonth()+1),src.getDate(),src.getHours(),src.getMinutes(),src.getSeconds());}},makeString:function(format,year,month,day,hour,min,sec){if(!hour){hour=0;}
if(!min){min=0;}
if(!sec){sec=0;}
var a=(new Date(year,month-1,day)).getDay()%7;if((year==this.now.getFullYear())&&(month==(this.now.getMonth()+1))&&(day==this.now.getDate())){format=format.replace("%D",(amdata.calendar.TIME_SEC_SHORT||""));format=format.replace("%v",(amdata.calendar.TIME_SHORT||""));}else{format=format.replace("%D",(amdata.calendar.DATE_SHORT||""));format=format.replace("%v",(amdata.calendar.DATE_SHORT||""));}
format=format.replace("%04Y",year.toString());format=format.replace("%Y",year.toString());format=format.replace("%02y",year.toString().substr(2));format=format.replace("%y",year.toString().substr(2));format=format.replace("%02m",(month<10)?("0"+month):month.toString());format=format.replace("%m",month.toString());format=format.replace("%02d",(day<10)?("0"+day):day.toString());format=format.replace("%d",day.toString());format=format.replace("%02H",(hour<10)?("0"+hour):hour.toString());format=format.replace("%H",hour.toString());format=format.replace("%02M",(min<10)?("0"+min):min.toString());format=format.replace("%M",min.toString());format=format.replace("%02S",(sec<10)?("0"+sec):sec.toString());format=format.replace("%S",sec.toString());if(amdata.calendar.WDAY_SHORT){format=format.replace("%a",amdata.calendar.WDAY_SHORT[a]);}
if(amdata.calendar.MONTH_SHORT){format=format.replace("%b",amdata.calendar.MONTH_SHORT[month-1]);}
if(amdata.calendar.WDAY_LONG){format=format.replace("%A",amdata.calendar.WDAY_LONG[a]);}
if(amdata.calendar.MONTH_LONG){format=format.replace("%B",amdata.calendar.MONTH_LONG[month-1]);}
format=format.replace("%Z",(this.timezone||""));return format;}};amtop.XMLUtil={loader:new dtmlXMLLoaderObject()};amtop.XMLUtil.select=function(node,expression){return this.loader.doXPath(expression,node);};amtop.XMLUtil.selectFirst=function(node,expression){return this.loader.doXPath(expression,node,null,"single");};amtop.XMLUtil.getUserData=function(node,name){var target=this.selectFirst(node,"userdata[@name='"+name+"']");if(target){if(is.fx){return target.textContent;}else if(target.firstChild){return target.firstChild.data;}}
return"";};amtop.XMLUtil.getAmData=function(node){var amdata={};var elms=node.getElementsByTagName("amdata");var len=elms.length;if(is.fx){for(var i=0;i<len;i++){amdata[elms[i].getAttribute("name")]=elms[i].textContent;}}else{for(var i=0;i<len;i++){if(elms[i].firstChild){amdata[elms[i].getAttribute("name")]=elms[i].firstChild.data;}else{amdata[elms[i].getAttribute("name")]="";}}}
return amdata;};am.mainWindowControl=Class.create();am.mainWindowControl.prototype={msg:null,event:null,checkBeforeUnload:false,defaultMsg:{beforeUnload:"This send mail window is shut."},initialize:function(obj){var set=obj?obj:{};this.initMsg(set.msg?set.msg:{});this.initEvent();},initMsg:function(obj){this.msg={};for(var key in this.defaultMsg){this.msg[key]=obj[key]?obj[key]:this.defaultMsg[key];}},initEvent:function(){this.event={beforeUnload:this._beforeUnload.bind(this)};this._checkBeforeUnload();this._beforeUnloadAttach();for(var key in this.event){this.attach(key);}},_beforeUnload:function(e){return e.returnValue=this.msg.beforeUnload;},_checkBeforeUnload:function(){if(amdata.sys.ENABLE_MAIN_CLOSE_CONFIRM=="on"&&amdata.usr.MAIN_CLOSE_CONFIRM=="on"){this.checkBeforeUnload=true;}},attach:function(key){switch(key){case"beforeUnload":break;default:key=key.toLowerCase();Event.observe(window,key,this.event[key]);break;}},_beforeUnloadAttach:function(){if(!this.checkBeforeUnload){return;}
var e=this.event.beforeUnload;if(!is.safari){Event.observe(window,"beforeunload",e);}else{window.addEventListener("beforeunload",e);}},disattach:function(key){switch(key){case"beforeUnload":this._beforeUnloadDisattach();break;default:key=key.toLowerCase();Event.stopObserving(window,key,this.event[key]);break;}},_beforeUnloadDisattach:function(){if(!this.checkBeforeUnload){return;}
var e=this.event.beforeUnload;if(!is.safari){Event.stopObserving(window,"beforeunload",e);}else{window.removeEventListener("beforeunload",e);}}};
