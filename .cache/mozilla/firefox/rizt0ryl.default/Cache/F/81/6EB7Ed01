YWget.AutoComplete=function(g,b,j,c){if(g&&b&&j){if(j instanceof YWget.DataSource){this.dataSource=j;}else{return;}if(YDom.inDocument(g)){if(YLang.isString(g)){this._sName="instance"+YWget.AutoComplete._nIndex+" "+g;this._elTextbox=document.getElementById(g);}else{this._sName=(g.id)?"instance"+YWget.AutoComplete._nIndex+" "+g.id:"instance"+YWget.AutoComplete._nIndex;this._elTextbox=g;}YDom.addClass(this._elTextbox,"yui-ac-input");}else{return;}if(YDom.inDocument(b)){if(YLang.isString(b)){this._elContainer=document.getElementById(b);}else{this._elContainer=b;}if(this._elContainer.style.display=="none"){}var d=this._elContainer.parentNode;var a=d.tagName.toLowerCase();if(a=="div"){YDom.addClass(d,"yui-ac");}else{}}else{return;}if(c&&(c.constructor==Object)){for(var i in c){if(i){this[i]=c[i];}}}this._initContainer();this._initProps();this._initContainerHelpers();var h=this;var f=this._elTextbox;var e=this._elContent;YUtil.Event.addListener(f,"keyup",h._onTextboxKeyUp,h);YUtil.Event.addListener(f,"keydown",h._onTextboxKeyDown,h);YUtil.Event.addListener(f,"focus",h._onTextboxFocus,h);YUtil.Event.addListener(f,"blur",h._onTextboxBlur,h);YUtil.Event.addListener(e,"mouseover",h._onContainerMouseover,h);YUtil.Event.addListener(e,"mouseout",h._onContainerMouseout,h);YUtil.Event.addListener(e,"scroll",h._onContainerScroll,h);YUtil.Event.addListener(e,"resize",h._onContainerResize,h);YUtil.Event.addListener(f,"keypress",h._onTextboxKeyPress,h);YUtil.Event.addListener(window,"unload",h._onWindowUnload,h);this.textboxFocusEvent=new YUtil.CustomEvent("textboxFocus",this);this.textboxKeyEvent=new YUtil.CustomEvent("textboxKey",this);this.dataRequestEvent=new YUtil.CustomEvent("dataRequest",this);this.dataReturnEvent=new YUtil.CustomEvent("dataReturn",this);this.dataErrorEvent=new YUtil.CustomEvent("dataError",this);this.containerExpandEvent=new YUtil.CustomEvent("containerExpand",this);this.itemMouseOverEvent=new YUtil.CustomEvent("itemMouseOver",this);this.itemMouseOutEvent=new YUtil.CustomEvent("itemMouseOut",this);this.itemArrowToEvent=new YUtil.CustomEvent("itemArrowTo",this);this.itemArrowFromEvent=new YUtil.CustomEvent("itemArrowFrom",this);this.itemSelectEvent=new YUtil.CustomEvent("itemSelect",this);this.unmatchedItemSelectEvent=new YUtil.CustomEvent("unmatchedItemSelect",this);this.selectionEnforceEvent=new YUtil.CustomEvent("selectionEnforce",this);this.containerCollapseEvent=new YUtil.CustomEvent("containerCollapse",this);this.textboxBlurEvent=new YUtil.CustomEvent("textboxBlur",this);f.setAttribute("autocomplete","off");YWget.AutoComplete._nIndex++;}else{}};YWget.AutoComplete.prototype={dataSource:null,minQueryLength:1,maxResultsDisplayed:10,FromChat:false,IncludeChat:true,IncludeText:true,queryDelay:0,highlightClassName:"yui-ac-highlight",prehighlightClassName:"yui-ac-hover",delimChar:",",autoHighlight:true,forceSelection:false,allowBrowserAutocomplete:true,alwaysShowContainer:false,useIFrame:false};YWget.AutoComplete.prototype.toString=function(){return"AutoComplete "+this._sName;};YWget.AutoComplete.prototype.isContainerOpen=function(){return this._bContainerOpen;};YWget.AutoComplete.prototype.getListItems=function(){return this._aListItems;};YWget.AutoComplete.prototype.getListItemData=function(a){if(a._oResultData){return a._oResultData;}else{return false;}};YWget.AutoComplete.prototype.setHeader=function(b){if(this._elHeader){var a=this._elHeader;if(b){a.innerHTML=b;a.style.display="block";}else{a.innerHTML="";a.style.display="none";}}};YWget.AutoComplete.prototype.setFooter=function(b){if(this._elFooter){var a=this._elFooter;if(b){a.innerHTML=b;a.style.display="block";}else{a.innerHTML="";a.style.display="none";}}};YWget.AutoComplete.prototype.setBody=function(a){if(this._elBody){var b=this._elBody;if(a){b.innerHTML=a;b.style.display="block";b.style.display="block";}else{b.innerHTML="";b.style.display="none";}this._maxResultsDisplayed=0;}};YWget.AutoComplete.prototype.formatABResult=function(c,h){this.itemHighlighted=false;var b=(typeof(c[5])!="undefined")?this.highlightQueryTerm(c[5],h):"";if(b.length){var i=[(' <span class="nick">'+b+" ("+MC.YM_STRINGS.ac_category+")</span>")];return i.join("");}var f=this.highlightQueryTerm(c[4],h);var e=this.highlightQueryTerm(c[1],h);var j=this.highlightQueryTerm(c[3],h);var g=this.highlightQueryTerm(c[0],h);var a=(h.indexOf(" ")!==-1)?(c[3]+" "+c[1]):false;var i=[];if(a){var d=this.highlightQueryTerm(a,h);i=['<span class="ac_line">',f.length?(' <span class="nick">'+f+"("+MC.YM_STRINGS.ac_nickname+")</span> - "):"",'<span class="name_first">',d,"</span> ",'<span class="email">&lt;',g,"&gt;</span>","</span>"];}else{i=['<span class="ac_line">',f.length?(' <span class="nick">'+f+"("+MC.YM_STRINGS.ac_nickname+")</span> - "):"",'<span class="name_last">',j,"</span> ",'<span class="name_first">',e,"</span> ",'<span class="email">&lt;',g,"&gt;</span>","</span>"];}return i.join("");};YWget.AutoComplete.prototype.formatBuddyResult=function(b,d){this.itemHighlighted=false;var c=this.highlightQueryTerm(b.tooltip,d);var a=['<span class="ac_line">',c,"</span>"];return a.join("");};YWget.AutoComplete.prototype.formatSMSResult=function(c,g){this.itemHighlighted=false;var f=c.NICKNAME?this.highlightQueryTerm(c.NICKNAME,g):"";var a=this.highlightQueryTerm(c.displayMobileNum,g);var b=(g.indexOf(" ")!==-1)?(c.FN+((c.LN)?(" "+c.LN):"")):false;var h=[];if(b){var d=this.highlightQueryTerm(b,g);h=['<span class="ac_line">',f.length?(' <span class="nick">'+f+"("+MC.YM_STRINGS.ac_nickname+")</span> - "):"",'<span class="name_first">',d,"</span> ",'<span class="email"> (',a,")</span>","</span>"];}else{var e=c.FN?this.highlightQueryTerm(c.FN,g):"";var i=c.LN?this.highlightQueryTerm(c.LN,g):"";h=['<span class="ac_line">',f.length?(' <span class="nick">'+f+"("+MC.YM_STRINGS.ac_nickname+")</span> - "):"",'<span class="name_first">',e,"</span> ",'<span class="name_last">',i,"</span> ",'<span class="email"> (',a,")</span>","</span>"];}return h.join("");};YWget.AutoComplete.prototype.highlightQueryTerm=function(b,a){if(b==null){return"";}if(this.itemHighlighted){return b;}var c=b.toLowerCase().indexOf(a.toLowerCase());if(c<0||c>0){return b;}this.itemHighlighted=true;return b.substr(0,c)+'<span class="qterm">'+b.substr(c,a.length)+"</span>"+b.substr(c+a.length);};YWget.AutoComplete.prototype.openChat=function(c,b){if(b[2].displayMobileNum){var a=MIM.smsUtil.normalizeMobileNum(b[2].displayMobileNum,imPrefs.homecountry);MEM.fire("im","onStartSMS",{id:(MGlbl.contactView._smsList+"|"+a)});}else{MEM.fire("im","onStartChat",b[2].key);}};YWget.AutoComplete.prototype.doBeforeExpandContainer=function(e,a,d,c){var b=YDom.getXY(e);b[1]+=YDom.get(e).offsetHeight;if(this.FromChat){a.style.width="177px";}else{if(MC.isIE6){a.style.width="611px";}else{a.style.width="614px";}}YDom.setXY(a,b);return true;};YWget.AutoComplete.prototype.sendQuery=function(a){this._sendQuery(a);};YWget.AutoComplete.prototype.doBeforeSendQuery=function(a){return a;};YWget.AutoComplete.prototype.destroy=function(){var b=this.toString();var a=this._elTextbox;var d=this._elContainer;this.textboxFocusEvent.unsubscribeAll();this.textboxKeyEvent.unsubscribeAll();this.dataRequestEvent.unsubscribeAll();this.dataReturnEvent.unsubscribeAll();this.dataErrorEvent.unsubscribeAll();this.containerExpandEvent.unsubscribeAll();this.itemMouseOverEvent.unsubscribeAll();this.itemMouseOutEvent.unsubscribeAll();this.itemArrowToEvent.unsubscribeAll();this.itemArrowFromEvent.unsubscribeAll();this.itemSelectEvent.unsubscribeAll();this.unmatchedItemSelectEvent.unsubscribeAll();this.selectionEnforceEvent.unsubscribeAll();this.containerCollapseEvent.unsubscribeAll();this.textboxBlurEvent.unsubscribeAll();YUtil.Event.purgeElement(a,true);YUtil.Event.purgeElement(d,true);d.innerHTML="";for(var c in this){if(YLang.hasOwnProperty(this,c)){this[c]=null;}}};YWget.AutoComplete.prototype.textboxFocusEvent=null;YWget.AutoComplete.prototype.textboxKeyEvent=null;YWget.AutoComplete.prototype.dataRequestEvent=null;YWget.AutoComplete.prototype.dataReturnEvent=null;YWget.AutoComplete.prototype.dataErrorEvent=null;YWget.AutoComplete.prototype.containerExpandEvent=null;YWget.AutoComplete.prototype.itemMouseOverEvent=null;YWget.AutoComplete.prototype.itemMouseOutEvent=null;YWget.AutoComplete.prototype.itemArrowToEvent=null;YWget.AutoComplete.prototype.itemArrowFromEvent=null;YWget.AutoComplete.prototype.itemSelectEvent=null;YWget.AutoComplete.prototype.unmatchedItemSelectEvent=null;YWget.AutoComplete.prototype.selectionEnforceEvent=null;YWget.AutoComplete.prototype.containerCollapseEvent=null;YWget.AutoComplete.prototype.textboxBlurEvent=null;YWget.AutoComplete._nIndex=0;YWget.AutoComplete.prototype._sName=null;YWget.AutoComplete.prototype._elTextbox=null;YWget.AutoComplete.prototype._elContainer=null;YWget.AutoComplete.prototype._elContent=null;YWget.AutoComplete.prototype._elHeader=null;YWget.AutoComplete.prototype._elBody=null;YWget.AutoComplete.prototype._elFooter=null;YWget.AutoComplete.prototype._elIFrame=null;YWget.AutoComplete.prototype._bFocused=true;YWget.AutoComplete.prototype._bContainerOpen=false;YWget.AutoComplete.prototype._bOverContainer=false;YWget.AutoComplete.prototype._aListItems=null;YWget.AutoComplete.prototype._nDisplayedItems=0;YWget.AutoComplete.prototype._maxResultsDisplayed=0;YWget.AutoComplete.prototype._sCurQuery=null;YWget.AutoComplete.prototype._sSavedQuery=null;YWget.AutoComplete.prototype._oCurItem=null;YWget.AutoComplete.prototype._bItemSelected=false;YWget.AutoComplete.prototype._nKeyCode=null;YWget.AutoComplete.prototype._nDelayID=-1;YWget.AutoComplete.prototype._iFrameSrc="javascript:false;";YWget.AutoComplete.prototype._queryInterval=null;YWget.AutoComplete.prototype._sLastTextboxValue=null;YWget.AutoComplete.prototype._initProps=function(){var b=this.minQueryLength;if(!YLang.isNumber(b)){this.minQueryLength=1;}var c=this.maxResultsDisplayed;if(!YLang.isNumber(c)||(c<1)){this.maxResultsDisplayed=10;}var d=this.queryDelay;if(!YLang.isNumber(d)||(d<0)){this.queryDelay=0.2;}var a=this.delimChar;if(YLang.isString(a)&&(a.length>0)){this.delimChar=[a];}else{if(!YLang.isArray(a)){this.delimChar=null;}}if(this.forceSelection&&a){}};YWget.AutoComplete.prototype._initContainerHelpers=function(){if(this.useIFrame&&!this._elIFrame){var a=document.createElement("iframe");a.src=this._iFrameSrc;a.frameBorder=0;a.scrolling="no";a.style.position="absolute";a.style.width="100%";a.style.height="100%";a.tabIndex=-1;this._elIFrame=this._elContainer.appendChild(a);}};YWget.AutoComplete.prototype._initContainer=function(){YDom.addClass(this._elContainer,"yui-ac-container");if(!this._elContent){var c=document.createElement("div");c.className="yui-ac-content";c.style.display="none";this._elContent=this._elContainer.appendChild(c);var b=document.createElement("div");b.className="yui-ac-hd";b.style.display="none";this._elHeader=this._elContent.appendChild(b);var d=document.createElement("div");d.className="yui-ac-bd";this._elBody=this._elContent.appendChild(d);var a=document.createElement("div");a.className="yui-ac-ft";a.style.display="none";this._elFooter=this._elContent.appendChild(a);}else{}};YWget.AutoComplete.prototype._initList=function(h){this._aListItems=[];while(this._elBody.hasChildNodes()){var f=this.getListItems();if(f){for(var a=f.length-1;a>=0;a--){f[a]=null;}}this._elBody.innerHTML="";}var j=0;if(!this.FromChat){var e=document.createElement("h3");e.className="yui-ac-abcontacts-heading";e.innerHTML=MC.YM_STRINGS.ac_addr_book_contacts;e=this._elBody.appendChild(e);var c=document.createElement("ul");c.className="yui-ac-abcontacts";c=this._elBody.appendChild(c);var b=h.abContacts.length;for(var d=0;d<b;d++){var g=document.createElement("li");g=c.appendChild(g);this._aListItems[j]=g;this._initListItem(g,j);j++;}}var b=h.buddies.length;if(b>0){if(!this.FromChat){var e=document.createElement("h3");e.className="yui-ac-onlinecontacts-heading";e.innerHTML=MC.YM_STRINGS.ac_online_chat;e=this._elBody.appendChild(e);}var c=document.createElement("ul");c.className="yui-ac-onlinecontacts";c=this._elBody.appendChild(c);for(var d=0;d<b;d++){var g=document.createElement("li");g=c.appendChild(g);this._aListItems[j]=g;this._initListItem(g,j);j++;}}var b=h.smsContacts.length;if(b>0){if(!this.FromChat){var e=document.createElement("h3");e.className="yui-ac-smscontacts-heading";e.innerHTML=MC.YM_STRINGS.ac_send_txt_msg;e=this._elBody.appendChild(e);}var c=document.createElement("ul");c.className="yui-ac-smscontacts";c=this._elBody.appendChild(c);for(var d=0;d<b;d++){var g=document.createElement("li");g.className="ac_mobile image";g=c.appendChild(g);this._aListItems[j]=g;this._initListItem(g,j);j++;}}this._maxResultsDisplayed=this.maxResultsDisplayed=j;};YWget.AutoComplete.prototype._initListItem=function(c,b){var a=this;c.style.display="none";c._nItemIndex=b;c.mouseover=c.mouseout=c.onclick=null;YUtil.Event.addListener(c,"mouseover",a._onItemMouseover,a);YUtil.Event.addListener(c,"mouseout",a._onItemMouseout,a);YUtil.Event.addListener(c,"click",a._onItemMouseclick,a);};YWget.AutoComplete.prototype._onIMEDetected=function(a){a._enableIntervalDetection();};YWget.AutoComplete.prototype._enableIntervalDetection=function(){var a=this._elTextbox.value;var b=this._sLastTextboxValue;if(a!=b){this._sLastTextboxValue=a;this._sendQuery(a);}};YWget.AutoComplete.prototype._cancelIntervalDetection=function(a){if(a._queryInterval){clearInterval(a._queryInterval);}};YWget.AutoComplete.prototype._isIgnoreKey=function(a){if((a==9)||(a==13)||(a==16)||(a==17)||(a>=18&&a<=20)||(a==27)||(a>=33&&a<=35)||(a>=36&&a<=40)||(a>=44&&a<=45)){return true;}return false;};YWget.AutoComplete.prototype._sendQuery=function(g){if(this.minQueryLength==-1){this._toggleContainer(false);return;}var c=(this.delimChar)?this.delimChar:null;if(c){var e=-1;for(var b=c.length-1;b>=0;b--){var f=g.lastIndexOf(c[b]);if(f>e){e=f;}}if(c[b]==" "){for(var a=c.length-1;a>=0;a--){if(g[e-1]==c[a]){e--;break;}}}if(e>-1){var d=e+1;while(g.charAt(d)==" "){d+=1;}this._sSavedQuery=g.substring(0,d);g=g.substr(d);}else{if(g.indexOf(this._sSavedQuery)<0){this._sSavedQuery=null;}}}if((g&&(g.length<this.minQueryLength))||(!g&&this.minQueryLength>0)){if(this._nDelayID!=-1){clearTimeout(this._nDelayID);}this._toggleContainer(false);return;}g=encodeURIComponent(g);this._nDelayID=-1;g=this.doBeforeSendQuery(g);this.dataRequestEvent.fire(this,g);this.dataSource.getResults(this._populateList,g,this);};YWget.AutoComplete.prototype._populateList=function(g,f,a){if(f===null){a.dataErrorEvent.fire(a,g);}if(!a._bFocused||!f){return;}var r=(navigator.userAgent.toLowerCase().indexOf("opera")!=-1);var m=a._elContent.style;m.width=(!r)?null:"";m.height=(!r)?null:"";var l=decodeURIComponent(g);a._sCurQuery=l;a._bItemSelected=false;a._initList(f);var b=a.maxResultsDisplayed;a._nDisplayedItems=b;if(b>0){a._initContainerHelpers();var j=a._aListItems;var e=0;var n=f.abContacts.length;for(var o=n-1;o>=0;o--){var h=j[o];var q=f.abContacts[o];h.innerHTML=a.formatABResult(q,l);h.style.display="list-item";if(q[1]){h._sResultKey='"'+q[3]+" "+q[1]+'"<'+q[0]+">";}else{h._sResultKey=(typeof(q[5])!="undefined")?q[5]:q[0];}h._oResultData=q;e++;}var s=e;var n=f.buddies.length;if(n>0){if(a.FromChat){var p=MIM.presenceList.arrBuddies;var k={};for(var c in p){k[p[c].key]=p[c].icon;}}var s=0;for(var o=f.abContacts.length+n-1;o>=e;o--){var h=j[o];var q=f.buddies[s];h.innerHTML=a.formatBuddyResult(q,l);if(a.FromChat){h.className=(k["0:"+q.key])?"ac_"+k["0:"+q.key]:"ac_offline image";}else{h.className="ac_"+q.icon;}h.imtype="chat";h.style.display="list-item";h._sResultKey=f.buddies[s].key;h._oResultData=q;s++;}}var n=f.smsContacts.length;if(n>0){var e=f.abContacts.length+f.buddies.length;var s=0;for(var o=e+n-1;o>=e;o--){var h=j[o];var q=f.smsContacts[s];h.innerHTML=a.formatSMSResult(q,l);h.style.display="list-item";h.imtype="sms";h._sResultKey=q.displayMobileNum;h._oResultData=q;s++;}}var d=a.doBeforeExpandContainer(a._elTextbox,a._elContainer,g,f);a._toggleContainer(d);if(a.autoHighlight){var t=j[0];a._toggleHighlight(t,"to");a.itemArrowToEvent.fire(a,t);}else{a._oCurItem=null;}}else{a._toggleContainer(false);}a.dataReturnEvent.fire(a,g,f);};YWget.AutoComplete.prototype._clearSelection=function(){var c=this._elTextbox.value;var b=(this.delimChar)?this.delimChar[0]:null;var a=(b)?c.lastIndexOf(b,c.length-2):-1;if(a>-1){this._elTextbox.value=c.substring(0,a);}else{this._elTextbox.value="";}this._sSavedQuery=this._elTextbox.value;this.selectionEnforceEvent.fire(this);};YWget.AutoComplete.prototype._textMatchesOption=function(){var d=null;for(var a=this._nDisplayedItems-1;a>=0;a--){var c=this._aListItems[a];var b=c._sResultKey.toLowerCase();if(b==this._sCurQuery.toLowerCase()){d=c;break;}}return(d);};YWget.AutoComplete.prototype._selectText=function(d,a,b){if(d.setSelectionRange){d.setSelectionRange(a,b);}else{if(d.createTextRange){var c=d.createTextRange();c.moveStart("character",a);c.moveEnd("character",b-d.value.length);c.select();}else{d.select();}}};YWget.AutoComplete.prototype._toggleContainerHelpers=function(b){var d=false;var c=this._elContent.offsetWidth+"px";var a=this._elContent.offsetHeight+"px";if(this.useIFrame&&this._elIFrame){d=true;if(b){this._elIFrame.style.width=c;this._elIFrame.style.height=a;}else{this._elIFrame.style.width=0;this._elIFrame.style.height=0;}}};YWget.AutoComplete.prototype._toggleContainer=function(b){var d=this._elContainer;if(this.alwaysShowContainer&&this._bContainerOpen){return;}if(!b){this._elContent.scrollTop=0;var a=this._aListItems;if(a&&(a.length>0)){for(var c=a.length-1;c>=0;c--){a[c].style.display="none";}}if(this._oCurItem){this._toggleHighlight(this._oCurItem,"from");}this._oCurItem=null;this._nDisplayedItems=0;this._sCurQuery=null;}if(!b&&!this._bContainerOpen){this._elContent.style.display="none";return;}if(b){this._elContent.style.display="block";this.containerExpandEvent.fire(this);}else{this._elContent.style.display="none";this.containerCollapseEvent.fire(this);}this._toggleContainerHelpers(b);this._bContainerOpen=b;};YWget.AutoComplete.prototype._toggleHighlight=function(a,c){var b=this.highlightClassName;if(this._oCurItem){YDom.removeClass(this._oCurItem,b);}if((c=="to")&&b){YDom.addClass(a,b);this._oCurItem=a;}};YWget.AutoComplete.prototype._togglePrehighlight=function(a,c){if(a==this._oCurItem){return;}var b=this.prehighlightClassName;if((c=="mouseover")&&b){YDom.addClass(a,b);}else{YDom.removeClass(a,b);}};YWget.AutoComplete.prototype._updateValue=function(e){var f=this._elTextbox;var d=(this.delimChar)?(this.delimChar[0]||this.delimChar):null;var b=this._sSavedQuery;var c=e._sResultKey.replace(/&#39;/g,"'");f.focus();f.value="";if(d){if(b){f.value=b;}f.value+=c+d;if(d!=" "){f.value+=" ";}}else{f.value=c;}if(f.type=="textarea"&&f.style.overflowY=="scroll"){f.scrollTop=f.scrollHeight;}var a=f.value.length;this._selectText(f,a,a);this._oCurItem=e;};YWget.AutoComplete.prototype._selectItem=function(a){this._bItemSelected=true;if(a.parentNode.className=="yui-ac-abcontacts"){this._updateValue(a);}this._cancelIntervalDetection(this);if(a.parentNode.className!="yui-ac-abcontacts"){if(this.FromChat){this._updateValue(a);}else{this.itemSelectEvent.fire(this,a,a._oResultData);if(a.imtype=="sms"){MIM.Track.beaconULT({ac:"cIniSMS"});}else{MIM.Track.beaconULT({ac:"cIniChat"});}}}this._toggleContainer(false);};YWget.AutoComplete.prototype._jumpSelection=function(){if(this._oCurItem){this._selectItem(this._oCurItem);}else{this._toggleContainer(false);}};YWget.AutoComplete.prototype._moveSelection=function(g){if(this._bContainerOpen){var e=this._oCurItem;var f=-1;if(e){f=e._nItemIndex;}var d=(g==40)?(f+1):(f-1);if(d<-2||d>=this._nDisplayedItems){return;}if(e){this._toggleHighlight(e,"from");this.itemArrowFromEvent.fire(this,e);}if(d==-1){if(this.delimChar&&this._sSavedQuery){if(!this._textMatchesOption()){this._elTextbox.value=this._sSavedQuery;}else{this._elTextbox.value=this._sSavedQuery+this._sCurQuery;}}else{this._elTextbox.value=this._sCurQuery;}this._oCurItem=null;return;}if(d==-2){this._toggleContainer(false);return;}var c=this._aListItems[d];var a=this._elContent;var b=((YDom.getStyle(a,"overflow")=="auto")||(YDom.getStyle(a,"overflowY")=="auto"));if(b&&(d>-1)&&(d<this._nDisplayedItems)){if(g==40){if((c.offsetTop+c.offsetHeight)>(a.scrollTop+a.offsetHeight)){a.scrollTop=(c.offsetTop+c.offsetHeight)-a.offsetHeight;}else{if((c.offsetTop+c.offsetHeight)<a.scrollTop){a.scrollTop=c.offsetTop;}}}else{if(c.offsetTop<a.scrollTop){this._elContent.scrollTop=c.offsetTop;}else{if(c.offsetTop>(a.scrollTop+a.offsetHeight)){this._elContent.scrollTop=(c.offsetTop+c.offsetHeight)-a.offsetHeight;}}}}this._toggleHighlight(c,"to");this.itemArrowToEvent.fire(this,c);}};YWget.AutoComplete.prototype._onItemMouseover=function(a,b){if(b.prehighlightClassName){b._togglePrehighlight(this,"mouseover");}else{b._toggleHighlight(this,"to");}b.itemMouseOverEvent.fire(b,this);};YWget.AutoComplete.prototype._onItemMouseout=function(a,b){if(b.prehighlightClassName){b._togglePrehighlight(this,"mouseout");}else{b._toggleHighlight(this,"from");}b.itemMouseOutEvent.fire(b,this);};YWget.AutoComplete.prototype._onItemMouseclick=function(a,b){b._toggleHighlight(this,"to");b._selectItem(this);};YWget.AutoComplete.prototype._onContainerMouseover=function(a,b){b._bOverContainer=true;};YWget.AutoComplete.prototype._onContainerMouseout=function(a,b){b._bOverContainer=false;if(b._oCurItem){b._toggleHighlight(b._oCurItem,"to");}};YWget.AutoComplete.prototype._onContainerScroll=function(a,b){b._elTextbox.focus();};YWget.AutoComplete.prototype._onContainerResize=function(a,b){b._toggleContainerHelpers(b._bContainerOpen);};YWget.AutoComplete.prototype._onTextboxKeyDown=function(a,b){var c=a.keyCode;switch(c){case 9:if((navigator.userAgent.toLowerCase().indexOf("mac")==-1)){if(b._oCurItem){if(b.delimChar&&(b._nKeyCode!=c)){if(b._bContainerOpen){YUtil.Event.stopEvent(a);}}b._selectItem(b._oCurItem);}else{b._toggleContainer(false);}}break;case 13:if((navigator.userAgent.toLowerCase().indexOf("mac")==-1)){if(b._oCurItem){if(b._nKeyCode!=c){if(b._bContainerOpen){YUtil.Event.stopEvent(a);}}b._selectItem(b._oCurItem);}else{b._toggleContainer(false);}}break;case 27:b._toggleContainer(false);return;case 39:b._jumpSelection();break;case 38:if(b._bContainerOpen){YUtil.Event.stopEvent(a);b._moveSelection(c);}break;case 40:if(b._bContainerOpen){YUtil.Event.stopEvent(a);b._moveSelection(c);}break;default:break;}};YWget.AutoComplete.prototype._onTextboxKeyPress=function(a,b){var c=a.keyCode;if((navigator.userAgent.toLowerCase().indexOf("mac")!=-1)){switch(c){case 9:if(b._oCurItem){if(b.delimChar&&(b._nKeyCode!=c)){if(b._bContainerOpen){YUtil.Event.stopEvent(a);}}b._selectItem(b._oCurItem);}else{b._toggleContainer(false);}break;case 13:if(b._oCurItem){if(b._nKeyCode!=c){if(b._bContainerOpen){YUtil.Event.stopEvent(a);}}b._selectItem(b._oCurItem);}else{b._toggleContainer(false);}break;default:break;}}else{if(c==229){b._queryInterval=setInterval(function(){b._onIMEDetected(b);},500);}}};YWget.AutoComplete.prototype._onTextboxKeyUp=function(b,d){d._initProps();var e=b.keyCode;d._nKeyCode=e;var c=this.value;if(d._isIgnoreKey(e)||(c.toLowerCase()==d._sCurQuery)){return;}else{d._bItemSelected=false;YDom.removeClass(d._oCurItem,d.highlightClassName);d._oCurItem=null;d.textboxKeyEvent.fire(d,e);}if(d.queryDelay>0){var a=setTimeout(function(){d._sendQuery(c);},(d.queryDelay*1000));if(d._nDelayID!=-1){clearTimeout(d._nDelayID);}d._nDelayID=a;}else{d._sendQuery(c);}};YWget.AutoComplete.prototype._onTextboxFocus=function(a,b){b._elTextbox.setAttribute("autocomplete","off");b._bFocused=true;if(!b._bItemSelected){b.textboxFocusEvent.fire(b);}};YWget.AutoComplete.prototype._onTextboxBlur=function(a,b){if(!b._bOverContainer||(b._nKeyCode==9)){if(!b._bItemSelected){var c=b._textMatchesOption();if(!b._bContainerOpen||(b._bContainerOpen&&(c===null))){if(b.forceSelection){b._clearSelection();}else{b.unmatchedItemSelectEvent.fire(b);}}else{if(b.forceSelection){}}}if(b._bContainerOpen){b._toggleContainer(false);}b._cancelIntervalDetection(b);b._bFocused=false;b.textboxBlurEvent.fire(b);}};YWget.AutoComplete.prototype._onWindowUnload=function(a,b){if(b&&b._elTextbox&&b.allowBrowserAutocomplete){b._elTextbox.setAttribute("autocomplete","on");}};YWget.DataSource=function(){};YWget.DataSource.ERROR_DATANULL="Response data was null";YWget.DataSource.ERROR_DATAPARSE="Response data could not be parsed";YWget.DataSource.prototype.maxCacheEntries=15;YWget.DataSource.prototype.toString=function(){return"DataSource "+this._sName;};YWget.DataSource.prototype.getResults=function(a,d,b){var c=this._doQueryCache(a,d,b);if(0&&c.length===0){this.queryEvent.fire(this,b,d);this.doQuery(a,d,b);}};YWget.DataSource.prototype.doQuery=function(a,c,b){};YWget.DataSource.prototype.flushCache=function(){if(this._aCache){this._aCache=[];}this.cacheFlushEvent.fire(this);};YWget.DataSource.prototype.queryEvent=null;YWget.DataSource.prototype.cacheQueryEvent=null;YWget.DataSource.prototype.getResultsEvent=null;YWget.DataSource.prototype.getCachedResultsEvent=null;YWget.DataSource.prototype.dataErrorEvent=null;YWget.DataSource.prototype.cacheFlushEvent=null;YWget.DataSource._nIndex=0;YWget.DataSource.prototype._sName=null;YWget.DataSource.prototype._aCache=null;YWget.DataSource.prototype._init=function(){var a=this.maxCacheEntries;if(!YLang.isNumber(a)||(a<0)){a=0;}if(a>0&&!this._aCache){this._aCache=[];}this._sName="instance"+YWget.DataSource._nIndex;YWget.DataSource._nIndex++;this.queryEvent=new YUtil.CustomEvent("query",this);this.cacheQueryEvent=new YUtil.CustomEvent("cacheQuery",this);this.getResultsEvent=new YUtil.CustomEvent("getResults",this);this.getCachedResultsEvent=new YUtil.CustomEvent("getCachedResults",this);this.dataErrorEvent=new YUtil.CustomEvent("dataError",this);this.cacheFlushEvent=new YUtil.CustomEvent("cacheFlush",this);};YWget.DataSource.prototype._addCacheElem=function(b){var a=this._aCache;if(!a||!b||!b.query||!b.results){return;}if(a.length>=this.maxCacheEntries){a.shift();}a.push(b);};YWget.DataSource.prototype._doQueryCache=function(c,g,a){var f=this._aCache;var j=(f)?f.length:0;var d=[];var b={query:"full",results:[]};if((this.maxCacheEntries>0)&&f&&(j>0)){for(var e=j-1;e>=0;e--){d=d.concat(f[e].results);}b.results=d;this._aCache=[];this._addCacheElem(b);var h=this._filterResults(b,g,a);c(g,h,a);}return d;};var displayString=[];YWget.DataSource.prototype._filterResults=function(k,p,q){var g=[];var d=[];var e=[];var v=[];var m=[];var l={abContacts:e,buddies:v,smsContacts:m};p=this.encodeRE(p);p=p.replace(/%26/g,"%26amp%3B");var j=new RegExp("^"+p,"i");var a=new RegExp("%20"+p.replace(/%20/g,"%20*(.*%20*)*"),"i");var t=YLang.trim;if(!q.FromChat){var n=k.results.length;for(var s=0;s<n;s++){var u=k.results[s];if(!displayString[s]){var h=t(u[3])+" "+t(u[1]);displayString.push(encodeURIComponent(" "+((u[4])?(u[4]+" "):"")+h+" "+u[0]));}if(((typeof(u[5])!="undefined")&&j.test(encodeURIComponent(u[5])))||a.test(displayString[s])){if(u[4]){g.push(k.results[s]);}else{if(u[5]){d.push(k.results[s]);}else{e.push(k.results[s]);}}}}}for(var s=0;s<d.length;s++){g.push(d[s]);}for(var s=0;s<e.length;s++){g.push(e[s]);}if(MC.pheasant.details.IM_Enabled){if(q.IncludeChat){if(q.FromChat){var b=MIM.presenceList;var o=b.allContacts;var n=o.length;for(var s in o){var c=o[s]["FN"]+((o[s]["LN"])?("%20"+o[s]["LN"]):"");if(j.test(o[s]["nickName"])||j.test(o[s]["FN"])||j.test(o[s]["LN"])||j.test(c)){o[s]["key"]=s.replace(/^[0-9]{1,2}:/,"");o[s]["tooltip"]=b._getNameFromAB(s,o[s]["nickName"]);v.push(o[s]);}}}else{var o=MIM.presenceList.arrBuddies;var n=o.length;var r=new RegExp("^"+decodeURIComponent(p),"i");for(var s=0;s<n;s++){if(r.test(o[s].tooltip)){v.push(o[s]);}}}}if(MC.IM_TOGGLE_STRINGS&&MC.IM_TOGGLE_STRINGS.im_enable_mobile_l10n&&q.IncludeText){var f=MIM.presenceList.mobileContacts;for(var s in f){var c=f[s]["FN"]+((f[s]["LN"])?("%20"+f[s]["LN"]):"");if(j.test(f[s]["nickName"])||j.test(f[s]["FN"])||j.test(f[s]["LN"])||j.test(f[s]["displayMobileNum"])||j.test(c)){m.push(f[s]);}}}}l={abContacts:g,buddies:v,smsContacts:m};return l;};YWget.DataSource.prototype.encodeRE=function(a){return a.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1");};YWget.DS_XHR=function(c,a,d){if(d&&(d.constructor==Object)){for(var b in d){this[b]=d[b];}}if(!YLang.isArray(a)||!YLang.isString(c)){return;}this.schema=a;this.scriptURI=c;this._init();};YWget.DS_XHR.prototype=new YWget.DataSource();YWget.DS_XHR.TYPE_XML=1;YWget.DS_XHR.ERROR_DATAXHR="XHR response failed";YWget.DS_XHR.prototype._oConn=null;YAHOO.register("autocomplete",YAHOO.widget.AutoComplete,{version:"2.5.2",build:"1076"});YAHOO.namespace("mc.pheasant");MAB.results=[];MAB.DS_ScriptNode=function(d,b,e){if(e&&(e.constructor==Object)){for(var c in e){this[c]=e[c];}}if(!YLang.isArray(b)||!YLang.isString(d)){return;}this.schema=b;if(d.indexOf("?")<0){this.scriptURI=d;}else{var a=d.split("?");this.scriptURI=a[0];this.scriptQueryAppend=a[1];}this._init();};MAB.DS_ScriptNode.prototype=new YWget.DataSource();MAB.DS_ScriptNode.prototype.constructor=MAB.DS_ScriptNode;MAB.DS_ScriptNode.prototype.scriptURI=null;MAB.DS_ScriptNode.prototype.scriptQueryParam="var";MAB.DS_ScriptNode.prototype.scriptQueryAppend="";MAB.DS_ScriptNode.prototype.responseStripAfter="\n<!-";MAB.DS_ScriptNode.prototype.scriptNodeName="generatedScriptNode";MAB.DS_ScriptNode.prototype.queryInProgress=false;MAB.DS_ScriptNode.prototype.doQuery=function(oCallbackFn,sQuery,oParent){if(this.queryInProgress){return;}var cDelimiter=(this.scriptURI.indexOf("?")==-1)?"?":"&";var sUri=this.scriptURI+cDelimiter+this.scriptQueryParam+"="+sQuery;if(this.scriptQueryAppend.length>0){sUri+="&"+this.scriptQueryAppend;}var oSelf=this;this.queryInProgress=true;ab_response=null;ab_error=null;if(!document.getElementById("ac")){var divNode=document.createElement("div");divNode.id="ac";document.getElementsByTagName("body")[0].appendChild(divNode);}YHttp.asyncRequest("GET",sUri,{success:function(o){ab_response=eval("("+o.responseText+")");oSelf._handleResponse(oSelf,oCallbackFn,sQuery,oParent);}});};MAB.DS_ScriptNode.prototype._handleResponse=function(c,b,f,d){if((ab_error==null)&&(ab_response==null)){}else{var e=c.parseResponse(f,null,d);var a={};a.query=decodeURIComponent(f);a.results=e;if(e===null){this.queryInProgress=false;c.dataErrorEvent.fire(c,d,f,YWget.DataSource.ERROR_DATAPARSE);e=[];}else{c.getResultsEvent.fire(c,d,f,e);c._addCacheElem(a);MAB.results=e;e=this._filterResults(a,f,d);}b(f,e,d);}};MAB.DS_ScriptNode.prototype.parseResponse=function(q,h,u){var d=this.schema.concat([]);var p=[];var f=0;var C=1;var e=1;if(ab_error!=null){return;}ab_response=this._filterDataFeed(ab_response);MC.abObj=[];for(var x=0;x<d.length;x++){if(d[x].indexOf(".")==-1){d[x]=[d[x],""];}else{d[x]=d[x].split(".");}}var A=d.concat([]);A.splice(0,2);var z=d[1];for(x=0;x<ab_response.contacts.length;x++){var g=[];var c=[];var a={};var B=[];var w=ab_response.contacts[x];for(var v=0;v<w.fields.length;v++){if(w.fields[v].type==z[f]){B.push(v);}else{if(typeof(a[w.fields[v].type])=="undefined"){for(var t=A.length-1;t>=0;t--){if(A[t][f]==w.fields[v].type){a[A[t][f]]=v;break;}}}}}for(var s=0;s<A.length;s++){var b="";if(typeof(w.fields[a[A[s][f]]])!="undefined"){b=this._parseContactFieldValueJSON(w.fields[a[A[s][f]]],A[s][C]);}c.push(b);}for(var r=0,o,y=B.length;r<y;r++){o=c.concat([]);b="";if(typeof(w.fields[B[r]])!="undefined"){b=this._parseContactFieldValueJSON(w.fields[B[r]],d[e][C]);}if(b!=""){o.unshift(b);}else{break;}if(typeof(g[o[0]])!="undefined"){break;}else{g[o[0]]=true;}acArr=o.slice(0,o.length-1);p.push(acArr);MC.abObj.push(o);}}var l=[];for(x=0;x<ab_response.contacts.length;x++){var w=ab_response.contacts[x];if(typeof(w.categories)!="undefined"){for(var v=0;v<w.categories.length;v++){if(typeof(w.categories[v].type)!="undefined"&&typeof(l[w.categories[v].data])=="undefined"){l[w.categories[v].data]=true;p.push(["","","","","",w.categories[v].data]);}}}}q=null;h=null;u=null;ab_response=null;ab_error=null;return p;};MAB.DS_ScriptNode.prototype._parseContactFieldValueJSON=function(b,a){if(typeof(a)!="string"){a="";}if(typeof(b.data)!="undefined"){if(a==""||b[a]){return b.data;}}else{if((a!="")&&(typeof(b[a])!="undefined")){return b[a];}}return"";};MAB.DS_ScriptNode.prototype._filterDataFeed=function(b){if(typeof(b)=="object"){for(var a in b){b[a]=this._filterDataFeed(b[a]);}return b;}else{if(typeof(b)=="string"){return b.replace(/[<>]/,"");}else{if(typeof(b)=="number"||typeof(b)=="boolean"){return b;}else{return null;}}}};MC.pheasant.oDatasource=new MAB.DS_ScriptNode(MC.pheasant.details.sUrl,MC.pheasant.details.aSchema);YUtil.Event.onDOMReady(function(){MC.pheasant.oDatasource.doQuery(YWget.AutoComplete.prototype._populateList,"preloading",YWget.AutoComplete);});