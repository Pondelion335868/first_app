var Class={create:function(){return function(){this.initialize.apply(this,arguments);};}};Object.extend=function(a,c){for(var b in c){a[b]=c[b];}return a;};Function.prototype.bind=function(){var a=this,c=$A(arguments),b=c.shift();return function(){return a.apply(b,c.concat($A(arguments)));};};Function.prototype.bindAsEventListener=function(b){var a=this;return function(c){return a.call(b,c||window.event);};};function $(){var c=[];for(var b=0;b<arguments.length;b++){var a=arguments[b];if(typeof a=="string"){a=document.getElementById(a);}if(arguments.length==1){return a;}c.push(a);}return c;}Array.from=function(c){if(!c){return[];}if(c.toArray){return c.toArray();}else{var b=[];for(var a=0;a<c.length;a++){b.push(c[a]);}return b;}};var $A=Array.from;DhtmlButton=Class.create();DhtmlButton.unselectableInIE=false;DhtmlButton.offscreenSizer=null;DhtmlButton.prototype={initialize:function(d,a,c,b){this._imgData=null;if(arguments.length>=3){this._imgData=c;}this._iconPaddingDecrement=0;if(arguments.length==4){this._iconPaddingDecrement=b;}this._action=a;this._gui=this.createGUI();},hide:function(){this._gui.style.visibility="hidden";},show:function(){this._gui.style.visibility="visible";},getGUI:function(){return this._gui;},setAction:function(a){this._action=a;},createGUI:function(){var a=(MC.isIE)?document.createElement("<a unselectable='on'>"):document.createElement("a");a.className="DhtmlButtonText";a.style.position="absolute";a.style.top="0px";a.style.display="block";this._imgData.setElementStyle(a);if(this._iconPaddingDecrement!=0){a.style.width=(this._imgData.width-this._iconPaddingDecrement)+"px";}if(!MC.Compose.globals.quota_exceeded){YUtil.Event.on(a,"mouseover",this.handleMouseOver,this,true);YUtil.Event.on(a,"mousedown",this.handleMouseDown,this,true);YUtil.Event.on(a,"mouseup",this.handleMouseUp,this,true);YUtil.Event.on(a,"mouseout",this.handleMouseOut,this,true);YUtil.Event.on(a,"click",this.handleClick,this,true);YUtil.Event.on(a,"focus",this.handleFocus,this,true);YUtil.Event.on(a,"blur",this.handleBlur,this,true);YUtil.Event.on(a,"keydown",this.handleKeyDown,this,true);}return a;},handleKeyDown:function(a){if(a.keyCode==13){this.handleClick(a);}},handleFocus:function(a){this.hasFocus=true;this.handleMouseOver(a);},handleBlur:function(a){this.hasFocus=false;this.handleMouseOut(a);},handleMouseOver:function(a){this._gui.className="RTEButtonMouseOver";},handleMouseOut:function(a){if(this.hasFocus){return;}this._gui.className="DhtmlButtonText";},handleMouseDown:function(a){this._gui.className="RTEButtonMouseOver";},handleMouseUp:function(a){this.handleMouseOver(a);},handleClick:function(a){YUtil.Event.preventDefault(a);if(this._action){this._action(a);}}};DhtmlMenuButton=Class.create();DhtmlMenuButton.STYLE_CLASS="dhtmlMenuButton";DhtmlMenuButton.prototype={initialize:function(b,a){this._label=b;this._action=a;this._gui=this._createGUI();},hide:function(){this._gui.style.visibility="hidden";},show:function(){this._gui.style.visibility="visible";},getGUI:function(){return this._gui;},setText:function(a){this._label=a;},setAction:function(a){this._action=a;},_createGUI:function(){var a=MC.isIE?document.createElement("<li unselectable='on'>"):document.createElement("li");a.className=DhtmlMenuButton.STYLE_CLASS;a.style.cursor="pointer";a.innerHTML=this._label;if(!MC.Compose.globals.quota_exceeded){YUtil.Event.on(a,"mouseover",this.handleMouseOver,this,true);YUtil.Event.on(a,"mouseout",this.handleMouseOut,this,true);YUtil.Event.on(a,"click",this.handleClick,this,true);YUtil.Event.on(a,"focus",this.handleFocus,this,true);YUtil.Event.on(a,"blur",this.handleBlur,this,true);YUtil.Event.on(a,"keydown",this.handleKeyDown,this,true);}a.onselectstart=function(){return false;};return a;},handleMouseOver:function(a){this._gui.className=DhtmlMenuButton.STYLE_CLASS+"_over";},handleMouseOut:function(a){if(this.hasFocus){return;}this._gui.className=DhtmlMenuButton.STYLE_CLASS;},handleClick:function(a){if(this._action){this._action(a);}},handleKeyDown:function(a){if(a.keyCode==13){this.handleClick(a);}},handleFocus:function(a){this.hasFocus=true;this.handleMouseOver(a);},handleBlur:function(a){this.hasFocus=false;this.handleMouseOut(a);}};FilmStripImageData=Class.create();FilmStripImageData.clone=function(a){return new FilmStripImageData(a.filmstripUrl,a.filmstripIndex,a.width,a.height,a.horizontal,a.repeat);};FilmStripImageData.prototype={initialize:function(d,c,b,e,a,f){this.filmstripUrl=d;this.filmstripIndex=c;this.width=b;this.height=e;this.horizontal=true;this.repeat=false;if(arguments.length>=5){this.horizontal=a;}if(arguments.length==6){this.repeat=f;}},setIndex:function(a){this.filmstripIndex=a;},createImageElement:function(){var a=document.createElement("div");this.setElementStyle(a);return a;},setElementStyle:function(a){if(this.horizontal){a.style.width=this.width+"px";if(!this.repeat){a.style.height=this.height+"px";}}else{a.style.height=this.height+"px";if(!this.repeat){a.style.width=this.width+"px";}}a.style.backgroundImage=this.filmstripUrl;this.setElementBgPosition(a);a.style.backgroundRepeat=this.repeat?(this.horizontal?"repeat-y":"repeat-x"):"no-repeat";},setElementBgPosition:function(a){a.style.backgroundPosition=(this.horizontal)?((this.width*-this.filmstripIndex)+3+"px 0px"):("0px "+(this.height*-this.filmstripIndex)+"px");},getStyleHTML:function(){var a="";if(this.horizontal){a="width:"+this.width+"px;";if(!this.repeat){a+="height:"+this.height+"px;";}}else{a="height:"+this.height+"px;";if(!this.repeat){a+="width:"+this.width+"px;";}}var c=(this.horizontal)?("background-position:"+(this.width*-this.filmstripIndex)+"px 0px;"):("background-position:0px "+(this.height*-this.filmstripIndex)+"px;");var b=this.repeat?(this.horizontal?"repeat-y":"repeat-x"):"no-repeat";return a+"background-image:"+this.filmstripUrl+";"+c+"background-repeat:"+b;}};function createRTE(){document.getElementById("composeArea").style.display="none";rte=new RichTextEditor("compose",MC.Compose.rteOptions);if(asyncMode){document.getElementById("rteContainer").innerHTML=rte;}else{document.write(rte);}rte.finishSetup();try{document.getElementById("composebox").removeChild(document.getElementById("plainLabel"));}catch(a){}}function initDoc(){window.parent.attachEvents();rte.setContent();rte.initializeDocument();if(MC.Compose.globals.stampRTE==1){setRTEStyleFrmDiv();}}RichTextEditor=Class.create();RichTextEditor.prototype={initialize:function(b,a){this._buttons=[];this._rendered=false;this._id=b;this._isDirty=true;this._setOptions(a);this._filmStrip=new FilmStripImageData("url("+this.options.filmStrip+")",0,this.options.buttonWidth,this.options.buttonHeight,true,false);},_setOptions:function(a){this.options={styleClass:"pim richTextEditorComp",width:613,bgColor:"#ffffff",disabledBgColor:"#f3f3f0",editorHeight:"295",alignmentMenuOptions:{flushLeftText:MC.Compose.richTxtStrings.FLUSH_LEFT,flushRightText:MC.Compose.richTxtStrings.FLUSH_RIGHT,centeredText:MC.Compose.richTxtStrings.CENTERED},bulletMenuOptions:{numberedListText:MC.Compose.richTxtStrings.NUMB_LIST,bulletedListText:MC.Compose.richTxtStrings.BULLE_LIST},htmlPostProcessor:null,blurHandler:null,insertLinkPromptText:MC.Compose.richTxtStrings.INSERT_LINK,noColorText:MC.Compose.richTxtStrings.NO_COLOR,defFontFamily:"'MS PGothic',sans-serif",defFontSize:"12pt",fontSizes:[8,10,12,14,18,24,36],fontSizeValues:{8:1,10:2,12:3,14:4,18:5,24:6,36:7},buttonWidth:30,buttonHeight:20,leftPad:-3,padding:2,paddingTop:4,paddingBottom:6,selectBackImg:"",selectBackColor:"",selectFontColor:"",selectFontFamily:"",dividerAfterPositions:[0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,0,1,1,0]};if(MC.Compose.globals.disableSpell){this.options.dividerAfterPositions.shift();}Object.extend(this.options,a||{});},finishSetup:function(){this._createDhtmlButtons();},setEnabled:function(b){if(!this._editorDocument){this.pendingDisable=!b;return;}this.pendingDisable=false;this.makeDocumentEditable(b);var a=b?this.options.bgColor:this.options.disabledBgColor;$(this._id+"_editorArea").style.backgroundColor=a;this._editorDocument.body.style.backgroundColor=a;},setContent:function(){var a=document.Compose.Content.value;if(this._editorDocument){try{this._editorDocument.body.innerHTML=a;this._pendingContent=null;}catch(b){this._pendingContent=null;this._editorDocument.write(a);this._editorDocument.close();this.initializeDocument();}}else{this._pendingContent=a;}a=null;},getEditorContent:function(){if(!this._editorDocument||!this._editorDocument.body){return"";}var a=this._editorDocument.body.innerHTML;a=a.replace(/<span\s.*id=[\'\"]?misspelled[\'\"]?[^>]*>(.*)<\/span>/i,"$1");return this._htmlPostProcess(a);},getStyleValue:function(a){return YDom.getStyle(this._editorDocument.body,a);},_htmlPostProcess:function(a){if(this.options.htmlPostProcessor){return this.options.htmlPostProcessor(a);}return a;},_createDhtmlButtons:function(){DhtmlButton.unselectableInIE=true;var d=$(this._id+"_palette");for(var c=MC.Compose.globals.disableSpell,a=this.options.numButtons;c<a;c++){var j=this.options.buttonNames[c];var b="_do"+j.substring(0,1).toUpperCase()+j.substring(1);var f=this[b].bindAsEventListener(this);this._createDhtmlButton(d,f,c);if(this.options.dividerAfterPositions[c+1]==1){this._separator=document.createElement("div");this._separator.className="RTEDivider";this._separator.style.top=this.options.paddingTop+"px";var e=this.options.leftPad+(this.options.padding*2);var g=(e+(c*(this.options.buttonWidth+2+this.options.padding)))+"px";g=parseInt(g,10)+this.options.padding+"px";this._separator.style.left=g;d.appendChild(this._separator);}}DhtmlButton.unselectableInIE=false;},_createDhtmlButton:function(c,e,b){this._filmStrip.setIndex(b);var d=this.options.leftPad+(this.options.padding*2);var f=(d+(b*(this.options.buttonWidth+2+this.options.padding))+this.options.dividerAfterPositions[b+1]*3)+"px";f=parseInt(f,10)+this.options.padding-(MC.Compose.globals.disableSpell*31)+"px";var a=new DhtmlButton("",e,FilmStripImageData.clone(this._filmStrip),4);this._buttons[this._buttons.length]=a;var g=a.getGUI();g.style.position="absolute";g.style.top=this.options.paddingTop+"px";g.style.left=f;g.title=MC.Compose.buttonTitles[b];g.href="#"+MC.Compose.buttonTitles[b];c.appendChild(g);},_createColorPickMenu:function(){this._colorPicker=document.createElement("div");this._colorPicker.style.display="none";this._colorPicker.style.border="2px solid #aaaaaa";this._colorPicker.style.backgroundColor="#ffffff";this._colorPicker.style.position="absolute";this._colorPicker.style.top=(this.options.paddingTop+this.options.buttonHeight+3)+"px";this._colorPalette=new ColorPalette("picker",{noColorText:this.options.noColorText});this._paletteDisplayed=false;this._colorPicker.style.zIndex=100;this._colorPicker.innerHTML=this._colorPalette;document.getElementById("rteContainer").insertBefore(this._colorPicker,document.getElementById("spellcontrol"));var a=this._colorPicker;SimplePopupMenu.register({isVisible:function(){return a.style.display!="none";},hide:function(){a.style.display="none";}});},_createFontMenus:function(){this._fontFamilyMenu=new FontFamilyMenu(this,this.options.fontFamilies);this._fontSizeMenu=new FontSizeMenu(this,this.options.fontSizes);},_createEmoticonsPickMenu:function(){this._emoticonPicker=document.createElement("div");this._emoticonPicker.id="emoticonMenu";this._emoticonPicker.style.display="none";this._emoticonPicker.style.border="2px solid #aaaaaa";this._emoticonPicker.style.backgroundColor="#ffffff";this._emoticonPicker.style.position="absolute";this._emoticonPicker.style.width="110px";this._emoticonPicker.style.top=(this.options.paddingTop+this.options.buttonHeight+3)+"px";this._emoticonPalette=new EmoticonPalette("picker",{noColorText:this.options.noColorText});this._emoticonPicker.innerHTML=this._emoticonPalette;this._emoticonPicker.style.zIndex=100;document.getElementById("rteContainer").insertBefore(this._emoticonPicker,document.getElementById("spellcontrol"));this.emoticonDisplayed=false;var a=this._emoticonPicker;SimplePopupMenu.register({isVisible:function(){return a.style.display!="none";},hide:function(){a.style.display="none";}});},_createEmojisPickMenu:function(){this._emojiPicker=document.createElement("div");this._emojiPicker.id="emojiMenu";this._emojiPicker.style.display="none";this._emojiPicker.style.border="2px solid #aaaaaa";this._emojiPicker.style.backgroundColor="#ffffff";this._emojiPicker.style.position="absolute";this._emojiPicker.style.width="330px";this._emojiPicker.style.top=(this.options.paddingTop+this.options.buttonHeight+3)+"px";this._emojiPalette=new EmojiPalette("picker",{noColorText:this.options.noColorText});this._emojiPalette.toString(this._emojiPalette.getEmojitype());this._emojiPicker.style.zIndex=100;document.getElementById("rteContainer").insertBefore(this._emojiPicker,document.getElementById("spellcontrol"));this.emojiDisplayed=false;var a=this._emojiPicker;SimplePopupMenu.register({isVisible:function(){return a.style.display!="none";},hide:function(){a.style.display="none";}});},_createAlignmentMenu:function(){this._alignmentMenu=new AlignmentMenu(this,this.options.alignmentMenuOptions);},_createBulletMenu:function(){this._bulletMenu=new BulletMenu(this,this.options.bulletMenuOptions);},getSelectedText:function(){var c;try{if(MC.isIE){c=this._editorDocument.selection;if(c&&c.type=="Text"){return c.text;}}else{var b=$(this._id+"_editorArea");c=b.contentWindow.getSelection();if(c){return c.toString();}}}catch(a){}return"";},replaceSelection:function(e){try{var d=$(this._id+"_editorArea");var f=d.contentWindow;if(f.getSelection!=null){this.replaceWindowSelectionMozilla(e);}else{var c=this._editorDocument.selection;var a=c.createRange();if(a!=null){a.text=e;}}}catch(b){}},replaceWindowSelectionMozilla:function(k){var f=$(this._id+"_editorArea");var d=f.contentWindow;var g=d.getSelection();if(!g){return;}var e=null;for(var c=g.rangeCount-1;c>=0;--c){e=g.getRangeAt(c);if(e){e.deleteContents();}}if(e){var b=(typeof k=="string")?document.createTextNode(k):k;var a=e.startContainer;if(a.nodeType==3&&b.nodeType==3){a.insertData(e.startOffset,b.nodeValue);var j=e.startOffset+b.length;e.setEnd(a,j);e.setStart(a,j);}else{e=e.cloneRange();g.removeAllRanges();e.insertNode(b);e.setEndAfter(b);e.setStartAfter(b);e.collapse(false);g.addRange(e);}}},initializeDocument:function(){var a=$(this._id+"_editorArea");var b;if(MC.isIE){b=a.contentWindow.document;}else{b=a.contentDocument;}this._editorDocument=b;this._addEventHandlersToEditorDocument();this._adjustStyleForEditorDocument();if(this._pendingContent){this.setContent();if(MC.isIE){a.blur();}}if(this.pendingDisable){this.setEnabled(false);}else{this.makeDocumentEditable(true);}this._editorDocument.body.style.fontFamily=this.options.defFontFamily;this._editorDocument.body.style.fontSize=this.options.defFontSize;this._editorDocument.body.style.padding="5px";if(MC.isIE){this._editorDocument.body.style.height=a.style.height;}},_adjustStyleForEditorDocument:function(){if(MC.isIE){var c=this._addStyleSheet(this._editorDocument);this._addStylesheetRule(c,"P","margin:0px;");this._addStylesheetRule(c,"UL","margin-top:5px;margin-bottom:5px;");this._addStylesheetRule(c,"OL","margin-top:5px;margin-bottom:5px;");}else{var b=this._editorDocument.getElementsByTagName("HEAD")[0];try{b.innerHTML='<STYLE TYPE="text/css">\nP {margin:0px;}\nUL,OL{margin-top:5px;margin-bottom:5px}\n</STYLE>';}catch(a){b=document.createElement("head");b=this._editorDocument.body.parentNode.insertBefore(b,this._editorDocument.body);var d=document.createElement("style");d.type="text/css";d.id="test";d=b.appendChild(d);if(d.styleSheet){d.styleSheet.cssText="P {margin:0px;}\nUL,OL{margin-top:5px;margin-bottom:5px}";}else{d.textContent="P {margin:0px;}\nUL,OL{margin-top:5px;margin-bottom:5px}";}}}this._editorDocument.body.hideFocus=true;},_addStyleSheet:function(b){var a=b.createElement("STYLE");b.getElementsByTagName("HEAD").item(0).appendChild(a);return b.styleSheets[b.styleSheets.length-1];},_addStylesheetRule:function(c,a,b){if(typeof c.addRule!="undefined"){c.addRule(a,b);}else{if(typeof c.insertRule!="undefined"){c.insertRule(a+" { "+b+" }",c.cssRules.length);}}},makeDocumentEditable:function(f,g){try{if(MC.isIE){this._editorDocument.body.contentEditable=f;}else{if(f){this._editorDocument.designMode="Off";}this._editorDocument.designMode=f?"On":"Off";}}catch(b){var d=new Date();var c;if(!startTime){c=new Date();}else{c=startTime;}var e=parseInt((d.getTime()-c.getTime())/1000);if(!startTime){MC.Compose.EditableTimer=setTimeout('"makeDocumentEditable('+f+", "+e+')"',500);}else{if(e>=0.5){clearTimeout(MC.Compose.EditableTimer);}}}},_addEventHandlersToEditorDocument:function(){if(MC.Compose.globals.quota_exceeded){return null;}if(MC.isIE){YUtil.Event.on(this._editorDocument,"click",this._handleEditorClick,this,true);YUtil.Event.on(this._editorDocument.body,"blur",this._handleBlur,this,true);YUtil.Event.on(this._editorDocument,"keydown",this._handleEditorKeyDown,this,true);}else{this._editorDocument.designMode="Off";YUtil.Event.on(this._editorDocument,"click",this._handleEditorClick,this,true);YUtil.Event.on(this._editorDocument,"blur",this._handleBlur,this,true);YUtil.Event.on(this._editorDocument,"keydown",this._handleEditorKeyDown,this,true);}},_handleEditorKeyDown:function(a){SimplePopupMenu.hideAll();a=(a==null)?$(this._id+"_editorArea").contentWindow.event:a;if(a.keyCode==9&&!a.shiftKey){YUtil.Event.preventDefault(a);if(document.getElementById("send_bottom")){document.getElementById("send_bottom").focus();}}if(this.onchange){this.onchange();}},_handleEditorClick:function(a){SimplePopupMenu.hideAll();},_handleBlur:function(b){try{if(this.options.blurHandler){this.options.blurHandler(this);}}catch(a){}},_doFontFamily:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._fontFamilyMenu){this._createFontMenus();}this._fontFamilyMenu.positionRelativeTo(b);this._fontFamilyMenu.show();},_doFontSize:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._fontSizeMenu){this._createFontMenus();}this._fontSizeMenu.positionRelativeTo(b);this._fontSizeMenu.show();},_changeFontFamily:function(a){SimplePopupMenu.hideAll();this.ensureEditorFocusIE();this._editorDocument.execCommand("FontName",false,a);this._focusEditorDeferred();},_changeFontSize:function(a){SimplePopupMenu.hideAll();this.ensureEditorFocusIE();var b=this.options.fontSizeValues[a.substr(0,a.length-2)];this._editorDocument.execCommand("FontSize",false,b+1);this._focusEditorDeferred();},_doSpellChk:function(a){if(MC.Compose.globals.disableSpell){return null;}SimplePopupMenu.hideAll();spellSubmit();},_doUserAction:function(a){SimplePopupMenu.hideAll();this.ensureEditorFocusIE();MC.isIE?this._editorDocument.execCommand(a):this._editorDocument.execCommand(a,false,null);this._focusEditorDeferred();if(this.onchange){this.onchange();}},_doBold:function(){this._doUserAction("Bold");},_doItalic:function(){this._doUserAction("Italic");},_doUnderline:function(){this._doUserAction("Underline");},_doTextColor:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._colorPicker){this._createColorPickMenu();}if(this._colorPicker.style.display=="none"){SimplePopupMenu.hideAll();this._colorPalette.setAction("setTextColor",this._setTextColor.bind(this));this._colorPicker.style.display="";YDom.setX(this._colorPicker,YDom.getX(b));if(!this.paletteDisplayed){YDom.setY(this._colorPicker,YDom.getY("compose_palette")+this.options.buttonHeight+this.options.paddingTop+3);this.paletteDisplayed=true;}if(speller){speller.disableSpell();}}else{if(this._colorPalette.getAction()=="setTextColor"){this._colorPicker.style.display="none";}else{this._colorPalette.setAction("setTextColor",this._setTextColor.bind(this));YDom.setX(this._colorPicker,YDom.getX(b));if(speller){speller.disableSpell();}}}},_setTextColor:function(b){this.ensureEditorFocusIE();var a=(b=="nocolor")?"#000000":"#"+b;this._editorDocument.execCommand("ForeColor",false,a);this._colorPicker.style.display="none";this._focusEditorDeferred();if(this.onchange){this.onchange();}},_doHiliteColor:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._colorPicker){this._createColorPickMenu();}if(this._colorPicker.style.display=="none"){SimplePopupMenu.hideAll();this._colorPalette.setAction("setHiliteColor",this._setHiliteColor.bind(this));this._colorPicker.style.display="";YDom.setX(this._colorPicker,YDom.getX(b));if(!this.paletteDisplayed){YDom.setY(this._colorPicker,YDom.getY("compose_palette")+this.options.buttonHeight+this.options.paddingTop+3);this.paletteDisplayed=true;}if(speller){speller.disableSpell();}}else{if(this._colorPalette.getAction()=="setHiliteColor"){this._colorPicker.style.display="none";}else{this._colorPalette.setAction("setHiliteColor",this._setHiliteColor.bind(this));YDom.setX(this._colorPicker,YDom.getX(b));if(speller){speller.disableSpell();}}}},_setHiliteColor:function(c){var a=MC.isIE?"BackColor":"HiliteColor";this.ensureEditorFocusIE();var b=(c=="nocolor")?"#FFFFFF":"#"+c;this._editorDocument.execCommand(a,false,b);this._colorPicker.style.display="none";this._focusEditorDeferred();if(this.onchange){this.onchange();}},_doEmoticon:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._emoticonPalette){this._createEmoticonsPickMenu();}if(this._emoticonPicker.style.display=="none"){SimplePopupMenu.hideAll();this._emoticonPalette.setAction("setEmoticon",this._setEmoticon.bind(this));this._emoticonPicker.style.left=b.style.left;this._emoticonPicker.style.display="";YDom.setX(this._emoticonPicker,YDom.getX(b));if(!this.emoticonDisplayed){YDom.setY(this._emoticonPicker,YDom.getY("compose_palette")+this.options.buttonHeight+this.options.paddingTop+3);this.emoticonDisplayed=true;}if(speller){speller.disableSpell();}}else{if(this._emoticonPalette.getAction()=="setEmoticon"){this._emoticonPicker.style.display="none";}else{this._emoticonPalette.setAction("setEmoticon",this._setEmoticon.bind(this));this._emoticonPicker.style.left=b.style.left;if(speller){speller.disableSpell();}}}this._focusEditorDeferred();if(this.onchange){this.onchange();}},_doEmoji:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._emojiPalette){this._createEmojisPickMenu();}if(this._emojiPicker.style.display=="none"){SimplePopupMenu.hideAll();this._emojiPalette.setAction("setEmoji",this._setEmoji.bind(this));this._emojiPalette.setChangeAction(this._changeEmojitype.bind(this));this._emojiPicker.style.left=b.style.left;this._emojiPicker.style.display="";YDom.setX(this._emojiPicker,YDom.getX(b));if(!this.emojiDisplayed){YDom.setY(this._emojiPicker,YDom.getY("compose_palette")+this.options.buttonHeight+this.options.paddingTop+3);this.emojiDisplayed=true;}if(speller){speller.disableSpell();}}else{if(this._emojiPalette.getAction()=="setEmoji"){this._emojiPicker.style.display="none";}else{this._emojiPalette.setAction("setEmoji",this._setEmoji.bind(this));this._emojiPicker.style.left=b.style.left;if(speller){speller.disableSpell();}}}this._focusEditorDeferred();if(this.onchange){this.onchange();}},_changeEmojitype:function(a){this._emojiPicker.style.display="";this._emojiPalette.toString(a);if(this.onchange){this.onchange();}},_setEmoticon:function(c){this.ensureEditorFocusIE();if(MC.isIE){var b='<img src="http://i.yimg.jp/i/mesg/tsmileys2/'+c+'.gif" />';var a=document.selection.createRange();a.select();a.pasteHTML(b);}else{this._editorDocument.execCommand("InsertImage",false,"http://i.yimg.jp/i/mesg/tsmileys2/"+c+".gif");}this._emoticonPicker.style.display="none";this._focusEditorDeferred();if(this.onchange){this.onchange();}},_setEmoji:function(b){this.ensureEditorFocusIE();if(MC.isIE){img='<img src="'+b+'" />';var a=document.selection.createRange();a.select();a.pasteHTML(img);}else{this._editorDocument.execCommand("InsertImage",false,b);}this._emojiPicker.style.display="";this._focusEditorDeferred();if(this.onchange){this.onchange();}},_doInsertLink:function(){SimplePopupMenu.hideAll();if(MC.isIE){this.ensureEditorFocusIE();this._editorDocument.execCommand("CreateLink",true,null);}else{this._doInsertLinkMozilla();}this._focusEditorDeferred();if(this.onchange){this.onchange();}},focusEditor:function(){var b;if(window.opera){b=$(this._id+"_editorArea");}else{b=$(this._id+"_editorArea").contentWindow;}try{b.focus();}catch(a){}},focusEditorOnStart:function(){var e=$(this._id+"_editorArea").contentWindow;e.document.body.style.padding="5px 0 0 5px";try{if(MC.isIE){e.document.body.focus();var d=e.document.body.createTextRange();d.collapse();d.select();}else{e.focus();var a=e.getSelection();var c=e.document.body;if(c!=null){a.selectAllChildren(c);a.collapseToStart();}this.makeDocumentEditable(true);}}catch(b){}},_focusEditorDeferred:function(){setTimeout(this.focusEditor.bind(this),1);},_doInsertLinkMozilla:function(){var b=prompt(this.options.insertLinkPromptText,"http://");if(b==null||b==""){return;}var c=this.getSelectedText();if(c==""){var a=this._editorDocument.createElement("A");a.setAttribute("HREF",b);a.appendChild(this._editorDocument.createTextNode(b));this.replaceSelection(a);}else{this._editorDocument.execCommand("CreateLink",false,b);}},_doInsertDivider:function(){this._doUserAction("InsertHorizontalRule");},_doAlign:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._alignmentMenu){this._createAlignmentMenu();}this._alignmentMenu.positionRelativeTo(b);this._alignmentMenu.toggle();},_doFlushLeft:function(a){this._doUserAction("JustifyLeft");},_doCentered:function(a){this._doUserAction("JustifyCenter");},_doFlushRight:function(a){this._doUserAction("JustifyRight");},_doBullets:function(a){var b=a.srcElement?a.srcElement:a.target;while(b.style.left==""){b=b.offsetParent;}if(!this._bulletMenu){this._createBulletMenu();}this._bulletMenu.positionRelativeTo(b);this._bulletMenu.toggle();},_doNumberedList:function(a){this._doUserAction("insertorderedlist");},_doBulletedList:function(a){this._doUserAction("insertunorderedlist");},_doIndentRight:function(){this._doUserAction("Indent");},_doIndentLeft:function(){this._doUserAction("Outdent");},_doStationary:function(){SimplePopupMenu.hideAll();var d,b,e,a;if(this._editorDocument){if(this.options.hasStationery==1){this.selectBackImg=this._editorDocument.body.style.backgroundImage;this.selectBackColor=this._editorDocument.body.style.backgroundColor;this.selectFontColor=this._editorDocument.body.style.color;this.selectFontFamily=this._editorDocument.body.style.fontFamily;b="stationery";e="Stationery";a="width=390x,height=370,scrollbars=no,dependent=yes,resizable=no";}else{b=this.options.stationeryURL;e="LearnMore";a="width=450,height=750,scrollbars=yes,dependent=yes,resizable=yes";}try{d=window.open(b,e,a);d.focus();}catch(c){if(typeof SymRealWinOpen!=="undefined"){window.open=SymRealWinOpen;rs(n,u,w,h,x);}}}},_removeBackGround:function(){this._editorDocument.body.style.backgroundImage=(this.selectBackImg)?this.selectBackImg:"";this._editorDocument.body.style.backgroundColor=(this.selectBackColor)?this.selectBackColor:"";this._editorDocument.body.style.color=(this.selectFontColor)?this.selectFontColor:"";this._editorDocument.body.style.fontFamily=(this.selectFontFamily)?this.selectFontFamily:this.options.defFontFamily;},_getFrameObject:function(){return this._editorDocument;},ensureEditorFocusIE:function(){if(!MC.isIE){return;}var a=$(this._id+"_editorArea");if(document.activeElement!=a){this.focusEditor();}},toString:function(){return this.htmls();},htmls:function(){var b=[];var c=this.options.width+"px";var a=(this.options.buttonHeight+this.options.paddingTop+this.options.paddingBottom)+"px";b[b.length]="<div id='";b[b.length]=this._id;b[b.length]="_palette' style='position:relative;width:";b[b.length]=c;b[b.length]="' class='";b[b.length]=this.options.styleClass;b[b.length]="'>";b[b.length]="<div style='height:"+a+"'></div></div>";b[b.length]='<div class="clearfix" style="position:absolute;padding-bottom:0px;margin-bottom:0px;top:-999px;" id="spellcontrol"></div>';this._addEditorArea(b);return b.join("");},_addEditorArea:function(b){var a=MC.isIE?0:2;b[b.length]="<iframe id='";b[b.length]=this._id;b[b.length]="_editorArea' ";b[b.length]="src='about:blank' frameborder='0' marginwidth='0' marginheight='0' allowTransparency='true' tabindex='"+document.getElementById("composeArea").tabIndex+"'";b[b.length]="hspace='0' vspace='0'  ";b[b.length]="title='"+document.getElementById("frameLabel").innerHTML+"' ";b[b.length]="onload='window.parent.initDoc();' ";b[b.length]="style='width:";if(MC.isIE6){b[b.length]="613";}else{b[b.length]="615";}b[b.length]="px !important;height:";b[b.length]=this.options.editorHeight;b[b.length]="px;";b[b.length]="border:1px solid #b3b6b0;background-color:#FFFFFF'>";b[b.length]="</iframe>";},hideAllMenus:function(){if(this._colorPicker){this._colorPicker.style.display="none";}if(this._emoticonPicker){this._emoticonPicker.style.display="none";}SimplePopupMenu.hideAll();}};ColorPalette=Class.create();ColorPalette.COLOR_SWATCHES=[["000000","111111","2d2d2d","434343","5b5b5b","737373","8b8b8b","a2a2a2","b9b9b9","d0d0d0","e6e6e6","ffffff"],["7f7f00","bfbf00","ffff00","ffff40","ffff80","ffffbf","525330","898a49","aea945","c3be71","e0dcaa","fcfae1"],["407f00","60bf00","80ff00","a0ff40","c0ff80","dfffbf","3b5738","668f5a","7f9757","8a9b55","b7c296","e6ebd5"],["007f40","00bf60","00ff80","40ffa0","80ffc0","bfffdf","033d21","438059","7fa37c","8dae94","acc6b5","ddebe2"],["007f7f","00bfbf","00ffff","40ffff","80ffff","bfffff","033d3d","347d7e","609a9f","96bdc4","b5d1d7","e2f1f4"],["00407f","0060bf","0080ff","40a0ff","80c0ff","bfdfff","1b2c48","385376","57708f","7792ac","a8bed1","deebf6"],["00007f","0000bf","0000ff","4040ff","8080ff","bfbfff","212143","373e68","444f75","585e82","8687a4","d2d1e1"],["40007f","6000bf","8000ff","a040ff","c080ff","dfbfff","302449","54466f","655a7f","726284","9e8fa9","dcd1df"],["7f007f","bf00bf","ff00ff","ff40ff","ff80ff","ffbfff","4a234a","794a72","936386","9d7292","c0a0b6","ecdae5"],["7f003f","bf005f","ff007f","ff409f","ff80bf","ffbfdf","451528","823857","a94a76","bc6f95","d8a5bb","f7dde9"],["800000","c00000","ff0000","ff4040","ff8080","ffc0c0","441415","82393c","aa4d4e","bc6e6e","d8a3a4","f8dddd"],["7f3f00","bf5f00","ff7f00","ff9f40","ffbf80","ffdfbf","482c1b","855a40","b27c51","c49b71","e1c4a8","fdeee0"]];ColorPalette.instances=[];ColorPalette.selectColor=function(e,b,d){var a=ColorPalette.instances[e];a.selectColor(ColorPalette.COLOR_SWATCHES[b][d]);};ColorPalette.noColor=function(b){var a=ColorPalette.instances[b];a.noColor();};ColorPalette.prototype={initialize:function(b,a){this._id=b;ColorPalette.instances[b]=this;this.options=a||{};if(!this.options.noColorText){this.options.noColorText="No Color";}},getAction:function(){return this.actionStr;},setAction:function(b,a){this.actionStr=b;this.action=a;},noColor:function(){this.action("nocolor");},selectColor:function(a){this.action(a);},toString:function(){var b=[];b[b.length]="<table width=168 height=168 border=0 cellspacing=0 cellpadding=0  unselectable='on' id='colorMenu'><tbody>";for(var c=0;c<12;c++){b[b.length]="<tr>";for(var a=0;a<12;a++){b[b.length]="<td><a ";b[b.length]=" style='background-color:#"+ColorPalette.COLOR_SWATCHES[c][a]+";font-size:1px;width:12px;height:12px;overflow:hidden;display:block;' ";b[b.length]=MC.isIE?'unselectable="on" ':"";b[b.length]="href=\"javascript:ColorPalette.selectColor('";b[b.length]=this._id+"',"+c+","+a+')"';b[b.length]=' title="#'+ColorPalette.COLOR_SWATCHES[c][a]+'">&nbsp;</a></td>';}b[b.length]="</tr>";}b[b.length]="</tbody></table>";b[b.length]="<div unselectable='on' style=\"cursor:pointer;cursor:hand;font-family:arial;font-size:8pt;\" onclick=\"ColorPalette.noColor('";b[b.length]=this._id+"')\">";b[b.length]=this.options.noColorText+"</div>";return b.join("");}};SimplePopupMenu=Class.create();SimplePopupMenu.allMenus=[];SimplePopupMenu.register=function(a){SimplePopupMenu.allMenus[SimplePopupMenu.allMenus.length]=a;};SimplePopupMenu.hideAll=function(){MC.menuObj.hideAll();for(var b=0,a=SimplePopupMenu.allMenus.length;b<a;b++){var c=SimplePopupMenu.allMenus[b];if(c.isVisible()){c.hide();}}};SimplePopupMenu.prototype={initialize:function(b,a){this._buttons=b;this.setOptions(a);this._createGUI();},setOptions:function(a){this.options={className:"SimpleMenuClass"};Object.extend(this.options,a||{});},_createGUI:function(){this._gui=MC.isIE?document.createElement("<ul unselectable='on'>"):document.createElement("ul");this._gui.className=this.options.className;this._gui.style.display="none";this._gui.style.position="absolute";this._gui.style.zIndex=100;for(var a=0;a<this._buttons.length;a++){this._gui.appendChild(this._buttons[a].getGUI());}},positionRelativeTo:function(a){this._gui.style.left=(a.offsetLeft+YDom.getX("compose_palette"))+"px";this._gui.style.top=(a.offsetTop+a.offsetWidth-4)+"px";},toggle:function(){if(this.isVisible()){this.hide();}else{this.show();}},isVisible:function(){return this._gui.style.display!="none";},show:function(){SimplePopupMenu.hideAll();this._gui.style.display="";YDom.setY(this._gui,YDom.getY("compose_palette")+this._richTextEditor.options.buttonHeight+10);if(speller){speller.disableSpell();}},hide:function(){this._gui.style.display="none";}};AlignmentMenu=Class.create();AlignmentMenu.prototype=Object.extend(new SimplePopupMenu([]),{initialize:function(c,a){this._richTextEditor=c;this.setOptions(a);if(!this.options.flushLeftText){this.options.flushLeftText=MC.Compose.richTxtStrings.FLUSH_LEFT;}if(!this.options.centeredText){this.options.centeredText=MC.Compose.richTxtStrings.CENTERED;}if(!this.options.flushRightText){this.options.flushRightText=MC.Compose.richTxtStrings.FLUSH_RIGHT;}this._buttons=[];DhtmlButton.unselectableInIE=true;this._buttons[0]=new DhtmlMenuButton(this.options.flushLeftText,this._doFlushLeft.bindAsEventListener(this));this._buttons[1]=new DhtmlMenuButton(this.options.centeredText,this._doCentered.bindAsEventListener(this));this._buttons[2]=new DhtmlMenuButton(this.options.flushRightText,this._doFlushRight.bindAsEventListener(this));DhtmlButton.unselectableInIE=false;this._createGUI();var b=$(c._id+"_palette");b.parentNode.insertBefore(this._gui,document.getElementById("compose_palette"));SimplePopupMenu.register(this);},_doFlushLeft:function(a){this._richTextEditor._doFlushLeft(a);this.hide();},_doCentered:function(a){this._richTextEditor._doCentered(a);this.hide();},_doFlushRight:function(a){this._richTextEditor._doFlushRight(a);this.hide();}});BulletMenu=Class.create();BulletMenu.prototype=Object.extend(new SimplePopupMenu([]),{initialize:function(c,a){this._richTextEditor=c;this.setOptions(a);if(!this.options.numberedListText){this.options.numberedListText=MC.Compose.richTxtStrings.NUMB_LIST;}if(!this.options.bulletedListText){this.options.bulletedListText=MC.Compose.richTxtStrings.BULLE_LIST;}this._buttons=[];DhtmlButton.unselectableInIE=true;this._buttons[0]=new DhtmlMenuButton(this.options.numberedListText,this._doNumberedList.bindAsEventListener(this));this._buttons[1]=new DhtmlMenuButton(this.options.bulletedListText,this._doBulletedList.bindAsEventListener(this));DhtmlButton.unselectableInIE=false;this._createGUI();var b=$(c._id+"_palette");b.parentNode.insertBefore(this._gui,document.getElementById("compose_palette"));SimplePopupMenu.register(this);},_doNumberedList:function(a){this._richTextEditor._doNumberedList(a);this.hide();},_doBulletedList:function(a){this._richTextEditor._doBulletedList(a);this.hide();}});EmoticonPalette=Class.create();EmoticonPalette.emoticon=["01","02","04","03","17","18","19","21","09","10","11","13","12","14","15","16","06","05","20","22","23","24","27","26","25","28","29","07","30","31","32","33","34","35","37","08","39","40","50","47"];EmoticonPalette.FlimStripEmoticon=["37","00","02","01","15","16","17","19","07","08","09","11","10","12","13","14","04","03","18","20","21","22","25","24","23","26","27","05","28","29","30","31","32","33","34","06","35","36","39","38"];EmoticonPalette.instances="";EmoticonPalette.selectEmoticon=function(b){var a=EmoticonPalette.instances;a.selectEmoticon(b);};EmoticonPalette.prototype={initialize:function(b,a){this._id=b;EmoticonPalette.instances=this;this.options=a||{};},getAction:function(){return this.actionStr;},setAction:function(b,a){this.actionStr=b;this.action=a;},selectEmoticon:function(a){this.action(a);},toString:function(){var b=[];for(var a=0,d=EmoticonPalette.emoticon.length;a<d;a++){b[b.length]="<a ";b[b.length]=MC.isIE?'unselectable="on" ':"";b[b.length]='style="background: transparent url(http://i.yimg.jp/i/jp/mesg/tsmileys2/emoticons_strip.gif) '+-1*EmoticonPalette.FlimStripEmoticon[a]*20+'px 0px no-repeat; width: 20px; height: 20px;display:block;float:left;" href="javascript:EmoticonPalette.selectEmoticon(\''+EmoticonPalette.emoticon[a]+"');\">";b[b.length]="&nbsp;</a>";}return b.join("");}};function emojiStateChange(b,a){document.getElementById(b+"_emojistatus").innerText=a;}function yFlex_menuChange(b,a){EmojiPalette.setEmojitype(a);}function yFlex_menuClick(b,a){EmojiPalette.selectEmoji(a);}var SuccessResponse=function(a){document.getElementById("emojiMenu").innerHTML=a.responseText;document.getElementById("emojiMenu").style.display="";};var FailureResponse=function(a){document.getElementById("emojiMenu").innerHTML="error";};EmojiPalette=Class.create();EmojiPalette.instances="";EmojiPalette.selectEmoji=function(b){var a=EmojiPalette.instances;a.selectEmoji(b);};EmojiPalette.setEmojitype=function(b){var a=EmojiPalette.instances;a.setEmojitype(b);};EmojiPalette.prototype={initialize:function(b,a){this._id=b;EmojiPalette.instances=this;this.options=a||{};},getAction:function(){return this.actionStr;},setAction:function(b,a){this.actionStr=b;this.action=a;},selectEmoji:function(a){this.action(a);},setChangeAction:function(a){this.actionChange=a;},getEmojitype:function(){return this.urlStr="apiProxy.php?action=emoji&rand="+(Math.floor(Math.random()*2147483647)%100000);},setEmojitype:function(a){if(a==""){this.urlStr="apiProxy.php?action=emoji&rand="+(Math.floor(Math.random()*2147483647)%100000);}else{this.urlStr="apiProxy.php?action=emoji&category="+a+"&rand="+(Math.floor(Math.random()*2147483647)%100000);}this.actionChange(this.urlStr);},toString:function(a){var b={success:SuccessResponse,failure:FailureResponse,timeout:1000};YHttp.asyncRequest("Get",a,b);return"";}};FontMenuItem=Class.create();FontMenuItem.prototype=Object.extend(new DhtmlMenuButton("",""),{initialize:function(d,c,a,b){this._label=d;this._action=c;this._rte=b;if(a&&a===true){this._bFontFamily=true;}this._gui=this._createGUI();},_createGUI:function(){var a=MC.isIE?document.createElement("<li unselectable='on'>"):document.createElement("li");a.className=DhtmlMenuButton.STYLE_CLASS;a.style.cursor="pointer";if(this._bFontFamily){a.style.fontFamily=this._rte.options.fontFamilyValues[this._label];a.style.fontSize="15px";}else{a.style.fontSize=this._label+"px";a.style.fontFamily="Arial";}a.innerHTML=(this._bFontFamily)?this._label:("Size "+this._label);if(!MC.Compose.globals.quota_exceeded){YUtil.Event.on(a,"mouseover",this.handleMouseOver,this,true);YUtil.Event.on(a,"mouseout",this.handleMouseOut,this,true);YUtil.Event.on(a,"click",this.handleClick,this,true);YUtil.Event.on(a,"focus",this.handleFocus,this,true);YUtil.Event.on(a,"blur",this.handleBlur,this,true);YUtil.Event.on(a,"keydown",this.handleKeyDown,this,true);}a.onselectstart=function(){return false;};a.margin="5px";return a;}});FontFamilyMenu=Class.create();FontFamilyMenu.prototype=Object.extend(new SimplePopupMenu([]),{initialize:function(d,e){this._richTextEditor=d;this._buttons=[];DhtmlButton.unselectableInIE=true;for(var b=0,a=e.length;b<a;b++){this._buttons[b]=new FontMenuItem(e[b],this._doFontFamily.bindAsEventListener(this),true,d);}DhtmlButton.unselectableInIE=false;this._createGUI();this._gui.style.width="180px";var c=$(d._id+"_palette");c.parentNode.insertBefore(this._gui,document.getElementById("compose_palette"));SimplePopupMenu.register(this);},_doFontFamily:function(a){var b=a.srcElement?a.srcElement:a.target;this._richTextEditor._changeFontFamily(b.style.fontFamily);}});FontSizeMenu=Class.create();FontSizeMenu.prototype=Object.extend(new SimplePopupMenu([]),{initialize:function(e,c){this._richTextEditor=e;this._buttons=[];DhtmlButton.unselectableInIE=true;for(var b=0,a=c.length;b<a;b++){this._buttons[b]=new FontMenuItem(c[b],this._doFontSize.bindAsEventListener(this),false);}DhtmlButton.unselectableInIE=false;this._createGUI();this._gui.style.width="150px";var d=$(e._id+"_palette");d.parentNode.insertBefore(this._gui,document.getElementById("compose_palette"));SimplePopupMenu.register(this);},_doFontSize:function(a){var c=a.srcElement?a.srcElement:a.target;var b=c.style.fontSize;this._richTextEditor._changeFontSize(b);}});function rs(j,d,b,f,a){var c="width="+b+",height="+f+",resizable=yes,scrollbars=yes,status=0";var g=window.open(d,j,c);try{if(g!==null&&g.opener===null){g.opener=self;g.focus();}else{if(g!==null){g.focus();}}}catch(e){if(typeof SymRealWinOpen!=="undefined"){window.open=SymRealWinOpen;rs(j,d,b,f,a);}}if(a==1){return g;}}function setField(b,a){document.Compose.elements[b].value=a;}function getField(a){return document.Compose[a].value;}function getAbsolutePath(){return document.URL.match(/^http:\/\/([a-zA-Z0-9_\.]+\/)+/)[0];}function chgFieldHeight(){var d=102,a=YDom.setStyle;var e=this;var b=parseInt(e.clientHeight,10);var c=parseInt(e.scrollHeight,10);a(e.id,"overflow","hidden");if(b<c){c+=4;if(c<d){a(e.id,"overflow-y","hidden");}else{c=d;a(e.id,"overflow-y","scroll");}c=c+"px";a(e.id,"height",c);}if(e.value.length===0){a(e.id,"height","19px");a(e.id,"overflow-y","hidden");}}function hideBcc(){var e=MC.Compose;var f=document.getElementById("bccid");var c=f.style.display;var b=document.getElementById("bcc");var a=document.getElementById("hideBcc");var d=document.getElementById("showBcc");if(c=="none"){f.style.display="";a.innerHTML=e.uiStrings.REMOVE_BCC;d.value="true";b.value="";b.focus();}else{if(b.value!==""){if(!confirm(e.globals.bcc_remove_warning)){return false;}}f.style.display="none";a.innerHTML=e.uiStrings.SHOW_BCC;d.value="false";b.value="";b.style.height="19px";}}var globalSpellFlag=true;function initAC(){YUtil.Event.onDOMReady(function(){var a=new YWget.AutoComplete("to",MC.pheasant.details.sAcDiv,MC.pheasant.oDatasource);a.itemSelectEvent.subscribe(a.openChat,null,a);var c=new YWget.AutoComplete("cc",MC.pheasant.details.sAcDiv,MC.pheasant.oDatasource);c.itemSelectEvent.subscribe(c.openChat,null,c);var b=new YWget.AutoComplete("bcc",MC.pheasant.details.sAcDiv,MC.pheasant.oDatasource);b.itemSelectEvent.subscribe(b.openChat,null,b);});}function init(c){YUtil.Event.on("Compose","submit",checkEmailExistence);var b=YUtil.Event;if(!MC.Compose.globals.isOpera){b.on(AC_targetElements,"keyup",chgFieldHeight);}b.on(AC_targetElements,"keyup",onChanges);b.on(["spellChecktop","spellCheckbottom"],"click",spellSubmit);YDom.setStyle("spellcontrol","width","552px");createSpellMenu();b.on("Subj","keydown",function(d){if(d.keyCode==13){b.preventDefault(d);focusBody(false);}});var a=document.getElementById("Compose")||document.forms.Compose;if(a.msgFlag.value=="draft"){MC.shortcuts.init();}}function createSpellMenu(){var b=document.getElementById("spellbox");if(b===null){spellController.addController("spellcontrol");var c=new SplitButton("Change","changemenu");var a=new SplitButton("Ignore","ignoremenu");}}function spellSubmit(c){if(MC.bSafari&&c){YUtil.Event.preventDefault(c);}if(globalSpellFlag){createSpellMenu();}var b=document.getElementById("compose_editorArea");if(b.tagName=="TEXTAREA"){document.getElementById("spellHide").value=b.value;if(document.getElementById("spellFlag")===null){var a=document.createElement("input");a.id="spellFlag";a.name="spellFlag";a.type="hidden";a.value="1";if(b.value.match("\r")!==null){a.value="2";}document.spellForm.appendChild(a);}}else{if(b.tagName=="IFRAME"){document.getElementById("spellHide").value=b.contentWindow.document.body.innerHTML;document.getElementById("iformat").value="html";}}document.spellForm.submit();enableSpell(false);}function parseSpellings(c){if(globalSpellFlag){var a=YDom.setStyle;a("spellcontrol","position","relative");a("spellcontrol","top","0");globalSpellFlag=false;}var b=[];b.length=0;b=c;speller=new Speller(b);spellController.showController();speller.setEditor(document.getElementById("compose_editorArea"));speller.update();}YUtil.Event.on(document,"click",function(a){if(typeof rte!="undefined"){var b=YUtil.Event.getTarget(a);if(b.nodeName.toUpperCase()!="A"||b.parentNode.id!="compose_palette"){rte.hideAllMenus();}}});function Speller(b){this.suggestObj=b;var a=this;this.text="";this.current=0;this.ignoreObj={};this.editBox=null;this.editDoc=null;this.editContent=null;this.isText=false;this.setEditor=function(c){this.editBox=c;this.isText=false;if(c.tagName=="IFRAME"){this.editDoc=c.contentWindow.document;this.editContent=this.editDoc.body;this.text=this.editContent.innerHTML;}else{if(c.tagName=="TEXTAREA"){this.editDoc=c;this.editContent=c;this.isText=true;this.text=document.getElementById("compose_editorArea").value;}else{alert("Speller.setEditor: unknown editBox type: "+c.tagName+" ("+typeof c+")");}}a.trapFocus(true);};this.trapFocus=function(f){var e=navigator.userAgent.toLowerCase().indexOf("msie")!=-1;var d=this.isText?"click":((e)?"focus":"mousedown");var c=(e)?this.editBox:this.editDoc;if(c!==null){if(f){YUtil.Event.on(c,d,this.disableSpell);}else{YUtil.Event.removeListener(c,d,this.disableSpell);}}};this.onChange=function(){if(this.current<this.suggestObj.length){this.changeWord(this.current);this.nextWord();}};this.onChangeAll=function(){var e=this.suggestObj[this.current],c,f;if(this.current<this.suggestObj.length){var d=this.text.substr(e.offset,e.word.length);this.changeWord(this.current);for(c=this.current+1;c<this.suggestObj.length;c++){f=this.suggestObj[c];if(!this.ignoreObj[c]&&this.text.substr(f.offset,f.word.length)==d){this.changeWord(c);this.ignoreObj[c]=true;}}this.nextWord();}};this.onIgnoreAll=function(){var e=this.suggestObj[this.current];if(this.current<this.suggestObj.length){var d=this.text.substr(e.offset,e.word.length);for(var c=this.current+1;c<this.suggestObj.length;c++){var f=this.suggestObj[c];if(!this.ignoreObj[c]&&this.text.substr(f.offset,f.word.length)==d){this.ignoreObj[c]=true;}}this.nextWord();}};this.onIgnore=function(){if(this.current<this.suggestObj.length){this.nextWord();}};this.changeWord=function(d){var e="";var f=document.getElementById("spellChange");var h=this.suggestObj[d];var g=parseInt(h.offset,10);var c=f.value.replace(/<\S[^><]*>/g,"");e+=this.text.substr(0,g);e+=c;e+=this.text.substr(g+h.word.length,this.text.length-(g+h.word.length));this.adjustOffsets(c.length-h.word.length,d+1);this.text=e;};this.nextWord=function(){while(this.current++<this.suggestObj.length&&this.ignoreObj[this.current]){}this.update();};this.adjustOffsets=function(e,d){for(var c=d;c<this.suggestObj.length;c++){this.suggestObj[c].offset=parseInt(this.suggestObj[c].offset,10)+e;}};this.disableSpell=function(){if(!a.isText){var c=a.editDoc.getElementById("misspelled");if(c!==null){var d=a.editDoc.createElement("span");d.innerHTML=c.innerHTML;c.parentNode.replaceChild(d,c);c.id="";}}a.trapFocus(false);a.finish();disableItem("Change",true);disableItem("Ignore",true);spellController.showMessage("SPELL_DISABLED");var e=document.getElementById("doneButton");if(e!==null){e.innerHTML=spellController.getString("RESUME_BTN");YUtil.Event.removeListener(e,"click");YUtil.Event.on(e,"click",a.enableSpell);}return true;};this.enableSpell=function(c){if(typeof rte!="undefined"){rte.hideAllMenus();}disableItem("doneButton",true);spellController.hideMessage();document.getElementById("spellbox").style.display="block";var d=document.getElementById("doneButton");if(d!==null){d.innerHTML=spellController.getString("CLOSE_BTN");YUtil.Event.removeListener(d,"click");YUtil.Event.on(d,"click",spellDone);}spellSubmit();};this.finish=function(){if(typeof this.corrections!="undefined"&&this.corrections!=null){this.current=this.corrections.length;this.update();this.text=null;}if(a.editDoc!==null){if(!a.isText){var d=a.editDoc.getElementById("misspelled");if(d!==null){var e=a.editDoc.createElement("span");e.innerHTML=d.innerHTML;d.parentNode.replaceChild(e,d);}}else{if(MC.isIE){var c=document.Compose.Content.createTextRange();c.moveStart("textedit");c.moveEnd("textedit");c.select();c.collapse(false);document.Compose.Content.blur();}}a.trapFocus(false);}};this.update=function(){var m=document.getElementById("spellChange");var g=document.getElementById("spellSelect");if(this.suggestObj!==null&&this.current<this.suggestObj.length){var k=this.suggestObj[this.current];var h=parseInt(k.offset,10);if(!this.isText){var l="";var o=this.text.substr(0,h+k.word.length);var c=new RegExp("<[^>]*alts*=s*['\"][^'\"]*"+k.word+"$","i");if(o.match(c)){this.onIgnore();}else{l+=this.text.substr(0,h);l+='<span id="misspelled">';l+=this.text.substr(h,k.word.length);l+="</span>";l+=this.text.substr(h+k.word.length,this.text.length-(h+k.word.length));this.editContent.innerHTML=l;var f=this.editDoc.getElementById("misspelled");YDom.setStyle(f,"background","transparent url(http://i.yimg.jp/i/jp/pim/splerror.gif) repeat-x scroll center bottom");f.scrollIntoView(false);}}else{this.editDoc.value=this.text;this.selectText(this.editContent,h,k.word.length);}g.options.length=0;var e=k.suggestions.length;if(e===0){m.value=this.text.substr(h,k.word.length);g.options[0]=new Option(spellController.getString("NO_SUGGESTIONS"),"",true,true);}else{m.value=k.suggestions[0];for(var j=0;j<e;j++){var d=k.suggestions[j];g.options[j]=new Option(d,d,(j===0),(j===0));}g.selectedIndex=0;}if(!this.isText){m.select();}}else{if(this.text!==null&&this.text!==""){if(!this.isText){this.editContent.innerHTML=this.text;}else{this.editDoc.value=this.text;}}var p=(this.suggestObj&&this.suggestObj.length>0)?"NO_MORE_MISSPELLINGS":"NO_MISSPELLINGS";spellController.showMessage(p);disableItem("Change",true);disableItem("Ignore",true);}};this.onKeyPressWord=function(c){if(c.keyCode==13){YUtil.Event.preventDefault(c);this.onChange();}};this.selectText=function(d,e,f){if(d.setSelectionRange){d.focus();d.setSelectionRange(e,e+f);}else{if(d.createTextRange){var c=d.createTextRange();c.collapse(true);var g=e-this.offsetDelta(this.text,e);c.moveStart("character",g);c.moveEnd("character",f);c.select();}}};this.lastIndex=0;this.lastDelta=0;this.offsetDelta=function(d,g){var e=0;var f=0;if(g>=this.lastIndex){e=this.lastIndex;f=this.lastDelta;}var c=Math.min(g,d.length);while(e<c){if(d.charCodeAt(e)==13){f++;}e++;}this.lastIndex=e;this.lastDelta=f;return f;};}var spellController={setString:function(b,a){MC.Compose.uiStrings[b]=a;},getString:function(b){var a=MC.Compose.uiStrings[b];if(a===null){return b;}return a;},addController:function(a){if(typeof a==="string"){a=document.getElementById(a);}var b="";b+='<div id="spellbox" class="clearfix">';b+='<div id="btnbox" class="first">';b+='<div id="spellmsg" style="display:none"></div>';b+='<div id="correction"><label for="spellChange">'+this.getString("CHANGE_LABEL")+'&nbsp;</label><input id="spellChange" onkeypress="speller.onKeyPressWord(event);" /></div>';b+='<button id="Change" class="hasdefaultstate" type="button" value="Change">'+this.getString("CHANGE_BTN")+"</button>";b+='<button id="Ignore" class="hasdefaultstate" type="button" value="Ignore">'+this.getString("IGNORE_BTN")+"</button>";b+='<button id="doneButton" type="button" value="Close" onclick="spellDone();">'+this.getString("CLOSE_BTN")+"</button>";b+="</div>";b+='<div id="slbox">';b+='<label id="sugglabel" for="spellSelect">'+this.getString("SUGG_LABEL")+"&nbsp;</label>";b+='<select id="spellSelect" size="4" onchange="spellController.onChangeSuggestions();"></select>';b+="</div>";b+="</div>";b+='<select id="changemenu">';b+='<option value="0">'+this.getString("CHANGE_ONE_ITEM")+"</option>";b+='<option value="1">'+this.getString("CHANGE_ALL_ITEM")+"</option>";b+="</select>";b+='<select id="ignoremenu">';b+='<option value="0">'+this.getString("IGNORE_ONE_ITEM")+"</option>";b+='<option value="1">'+this.getString("IGNORE_ALL_ITEM")+"</option>";b+="</select>";a.innerHTML=b;},showController:function(b){var a=document.getElementById("spellbox");if(a===null){spellController.addController("spellcontrol");a=document.getElementById("spellbox");}if(a!==null){a.style.display="block";this.hideMessage();disableItem("Change",false);disableItem("Ignore",false);disableItem("doneButton",false);disableItem("spellChange",false);disableItem("spellSelect",false);}YUtil.Event.on(["send_top","send_bottom","save_top","save_bottom","attachFiles"],"click",clearMisspelled);},hideController:function(){var a=document.getElementById("spellbox");if(a!==null){a.style.display="none";}YUtil.Event.removeListener(["send_top","send_bottom","save_top","save_bottom","attachFiles"],"click",clearMisspelled);},disableItem:function(b,a){},onChangeSuggestions:function(){var a=document.getElementById("spellSelect");var b=a.options[a.selectedIndex].value;if(b!==""){document.getElementById("spellChange").value=b;}},showMessage:function(c){var b=document.getElementById("spellmsg");if(b!==null){b.innerHTML=this.getString(c);var a=document.getElementById("correction");if(a!==null){a.style.display="none";}a=document.getElementById("sugglabel");if(a!==null){a.style.display="none";}a=document.getElementById("spellSelect");if(a!==null){a.style.display="none";}b.style.display="block";}},hideMessage:function(){var b=document.getElementById("spellmsg");if(b!==null){b.style.display="none";var a=document.getElementById("correction");if(a!==null){a.style.display="";}a=document.getElementById("sugglabel");if(a!==null){a.style.display="";}a=document.getElementById("spellSelect");if(a!==null){a.style.display="";}}}};function spellDone(){if(typeof speller!=="undefined"&&speller!==null){speller.finish();spellController.hideController();speller=null;}enableSpell(true);}function disableItem(c,b){var a=(b)?"#999":"#000";var d=document.getElementById(c);if(d!==null){d.disabled=b;d.style.color=a;}}function enableSpell(a){var b=document.getElementById("spellChecktop");if(b!==null){b.disabled=!a;}b=document.getElementById("spellCheckbottom");if(b!==null){b.disabled=!a;}MC.Compose.globals.disableSpell=!a;}function clearMisspelled(){var d=document.getElementById("compose_editorArea");if(d.tagName=="IFRAME"){var c=d.contentWindow.document;var a=c.getElementById("misspelled");if(a!==null){var b=c.createElement("span");b.innerHTML=a.innerHTML;a.parentNode.replaceChild(b,a);a.id="";}}}if(typeof MC.Compose.globals.autoSaveFreq!="undefined"){if(MC.Compose.globals.autoSaveFreq){YUtil.Event.on(window,"load",attachEvents);}}function attachEvents(){if(!MC.isIE){YUtil.Event.removeListener(["to","cc","bcc","Subj"],"keydown",startTimer);if(document.getElementById("compose_editorArea").tagName=="IFRAME"){YUtil.Event.removeListener(document.getElementById("compose_editorArea").contentWindow.document,"keydown",startTimer);}else{YUtil.Event.removeListener("compose_editorArea","keydown",startTimer);}YUtil.Event.removeListener(["send_top","send_bottom","save_top","save_bottom","cancelbuttontop","cancelbuttonbottom","attachFiles"],"click",checkAutosave);}YUtil.Event.on(["to","cc","bcc","Subj"],"keydown",startTimer);YUtil.Event.on("compose_palette","click",startTimer);if(document.getElementById("compose_editorArea").tagName=="IFRAME"){YUtil.Event.on(document.getElementById("compose_editorArea").contentWindow.document,"keydown",startTimer);}else{YUtil.Event.on("compose_editorArea","keydown",startTimer);}YUtil.Event.on(["send_top","send_bottom","save_top","save_bottom","cancelbuttontop","cancelbuttonbottom","attachFiles"],"click",checkAutosave);}MC.Compose.globals.timerFlag=true;MC.Compose.globals.asProgress=false;MC.Compose.globals.checkHappened=MC.Compose.globals.disableButtons=false;MC.Compose.globals.disableBtnArray=["send_top","send_bottom","save_top","save_bottom"];function checkAutosave(b){var a=MC.Compose.globals;if(a.asProgress){YUtil.Event.preventDefault(b);a.checkHappened=YUtil.Event.getTarget(b);document.body.style.cursor="progress";}else{var c=YUtil.Event.getTarget(b);if(c.id.match(/save_(top|bottom)|send_(top|bottom)/)){a.disableButtons=true;}}}function startTimer(){if(MC.Compose.globals.timerFlag){MC.Compose.globals.timerFlag=false;MC.Compose.globals.asTimer=setTimeout(function(){try{autoSave();}catch(a){clearTimeout(MC.Compose.globals.asTimer);globals.timerFlag=true;}},MC.Compose.globals.autoSaveFreq*1000);}}function autoSave(){formObj=document.getElementById("Compose")||document.forms.Compose;if(!formObj){return;}var b=document.Compose.Content.value;if(document.getElementById("compose_editorArea").tagName=="IFRAME"){setTextArea();b=rte.getEditorContent();if(b=="<br>"){b="";}}if(formObj.to.value===""&&formObj.cc.value===""&&formObj.bcc.value===""&&formObj.Subj.value===""&&b===""&&!MC.Compose.globals.uploadChange){MC.Compose.globals.timerFlag=true;}else{if(typeof formObj.asTime==="undefined"){createHiddenEl("asTime");}var a=new Date();formObj.asTime.value=a.getTime();if(typeof formObj.asOffset==="undefined"){createHiddenEl("asOffset");}formObj.asOffset.value=a.getTimezoneOffset();if(document.getElementById("compose_editorArea").tagName=="IFRAME"){document.Compose.Content.value=b;}YHttp.setForm(formObj);var c=YHttp.asyncRequest("POST","compose?action_msg_autosave=1&noc&view=none",{success:function(f){try{endTimer(f);}catch(d){if(MC.Compose.globals.asTimer){clearTimeout(MC.Compose.globals.asTimer);}MC.Compose.globals.timerFlag=true;}},failure:function(d){submitCheck(true);}});MC.Compose.globals.asProgress=YHttp.isCallInProgress(c);}}var endTimer=function(b){var l=YLang.JSON,f;try{var a=l.parse(b.responseText);}catch(h){var a=new Object;a.error=true;}if(!a.error){if(typeof formObj.autoSave==="undefined"){createHiddenEl("autoSave");}formObj.autoSave.value=a.msgInfo.mid;if(formObj.msgFlag.value=="draft"){formObj.mid.value=a.msgInfo.mid;}if(a.msgInfo.attachments){var j=[];var g=a.msgInfo.attachments.length;var d=a.msgInfo.attachments;for(f=0;f<g;f++){j[f]=[d[f][0],d[f][1],d[f][3]];}formObj.attachment.value=l.stringify(j);var e=YDom.getElementsByClassName("transbuttons");g=e.length;for(f=0;f<g;f++){e[f].name="action_attachment_remove_pid_"+d[f][2];}}if(submitCheck(false)){return;}var k=document.getElementById("asSpan");if(k===null){var c=document.createElement("b");c.id="asSpan";c.setAttribute("role","alert");document.getElementById("composebuttonbartop").appendChild(c);k=document.getElementById("asSpan");}k.innerHTML=a.message;}else{submitCheck(true);throw new Error("autoSave failed");}};YUtil.Event.on(window,"beforeunload",function(){try{if(MC.Compose.globals.composeMode=="dynamic"){document.Compose.Content.value=rte.getEditorContent();}}catch(a){}});function submitCheck(b){var c=MC.Compose.globals;c.timerFlag=(b)?false:true;c.asProgress=false;if(c.checkHappened){checkEmailExistence();createHiddenEl(c.checkHappened.name);if(c.composeMode=="dynamic"){document.Compose.Content.value=rte.getEditorContent();}var a=document.getElementById("Compose")||document.forms.Compose;if(asyncMode){MC.asyncManager.get(a.action+"&clean","compose",a);}else{a.submit();}return true;}else{return false;}}function createHiddenEl(c){var b=document.createElement("input");b.type="hidden";b.name=b.id=c;if(typeof a==="undefined"||a===null){var a=document.getElementById("Compose")||document.forms.Compose;}a.appendChild(b);b=null;}function toggleRTE(f){YUtil.Event.preventDefault(f);if(MC.Compose.globals.composeMode=="dynamic"&&!(rte._editorDocument.body.innerHTML=="<br>"||confirm(MC.Compose.uiStrings.TOGGLE_RTE))){return;}var c=document.createElement("input");c.type="hidden";c.name="action_compose_toggle";c.value="1";document.getElementById("Compose").appendChild(c);var b=document.createElement("input");b.type="hidden";b.name="uc1";b=document.getElementById("Compose").appendChild(b);document.getElementById("Compose").action=MC.Compose.globals.toggleURL;if(MC.Compose.globals.composeMode=="dynamic"){b.value="1";var d=rte.getEditorContent();d=d.replace(/\n/g,"");document.Compose.Content.value=d;}else{b.value="0";}var a=document.getElementById("Compose")||document.forms.Compose;if(MC.Compose.globals.composeMode!="dynamic"){MDom.insert('<input type="hidden" name="cMode" value="true">',a);}if(asyncMode){MC.asyncManager.get(a.action+"&clean&nsc=1","compose",a);}else{a.submit();}b=toggleRTEState=null;}function showToggleLink(){var b=YDom;var a=b.setStyle,d;var e=document.getElementById("composeAttachButton");if(!MC.Compose.globals.quota_exceeded){d=document.createElement("a");d.id="toggleLink";d.href="#";d.innerHTML=MC.Compose.globals.toggleLabel;d.title=MC.Compose.globals.toggleTitle;d.style.position="absolute";d=e.appendChild(d);YUtil.Event.on("toggleLink","click",toggleRTE);}else{d=document.createElement("span");d.id="toggleLink";d.innerHTML=MC.Compose.globals.toggleLabel;d.style.position="absolute";d=e.appendChild(d);}var c=document.getElementById("to").offsetWidth-d.offsetWidth;if(c<0){YUtil.Event.on(window,"load",function(){var f=document.getElementById("to").offsetWidth-d.offsetWidth;d.style.left=f+"px";});}d.style.left=c+"px";a(d,"padding-top","6px");a(d,"text-decoration","underline");}function changeABLinks(c){var b=document.getElementById("lb_"+c);var a=document.createElement("a");a.innerHTML=b.innerHTML;document.getElementById("compose_"+c).replaceChild(a,b);}function setFlag(){MC.Compose.globals.focusFieldFlag=0;}function setFieldFocus(a){if(MC.Compose.globals.focusFieldFlag){setTimeout(function(){setProperFocus();},1);}}function setProperFocus(){if(!focusTo()){focusBody(true);}}function focusBody(a){if(document.getElementById("compose_editorArea").tagName=="IFRAME"){if(a){rte.focusEditorOnStart();}else{rte.ensureEditorFocusIE();rte._focusEditorDeferred();}}else{document.Compose.Content.selectionStart=0;document.Compose.Content.selectionEnd=0;document.Compose.Content.focus();}}function focusTo(){if(document.Compose.to.value===""){document.Compose.to.focus();return true;}return false;}function onChanges(a){setTimeout(function(){align();},15);}function align(){var b=document.getElementById("ac_select");var e,d=YDom;var a=d.setStyle,c=d.getStyle;a(b,200);d.setX(b,d.getX("to"));e=c("to","offsetWidth");if(e){a(b,"offsetWidth",e);}else{a(b,"width",c("to","width"));}}function setTextArea(){var a=document.getElementById("Compose")||document.forms.Compose;if(document.getElementById("compose_editorArea").tagName=="IFRAME"){var e="";var d=rte.getStyleValue("color");var g=rte.getStyleValue("backgroundColor");var c=rte.getStyleValue("fontFamily");var f=rte.getStyleValue("fontSize");var b=rte.getStyleValue("backgroundImage");if(b.substring(0,3)=="url"){b=b.substring(4,b.length-1);}if(a.st_desc.value!==""&&a.st_desc.value!="None-Theme"){e="background='"+b+"' style='font-family:"+c+";font-size:"+f+";color:"+d+";background-color:"+g+";width:100%;'";a.embstyle.value=e;}document.Compose.Content.value=rte._editorDocument.body.innerHTML;}}function setRTEStyleFrmDiv(){var g=document.getElementById("compose_editorArea").contentWindow.document;var d=g.getElementById("bodyDrftID");if(d){var e=d.parentNode.id;d.parentNode.id="";var f=g.body,c=YDom;var a=c.setStyle,b=c.getStyle;a(f,"color",b(d,"color"));a(f,"fontFamily",b(d,"fontFamily"));a(f,"backgroundImage",b(d,"backgroundImage"));a(f,"backgroundColor",b(d,"backgroundColor"));if(MC.isIE){d.style.color="";d.style.fontFamily="";d.style.backgroundImage="";d.style.backgroundColor="";}else{d.setAttribute("style","");}d.id="";if(g.getElementById("drftMsgContent")){g.body.innerHTML='<div id="'+e+'">'+g.getElementById("drftMsgContent").innerHTML+"</div>";}document.Compose.st_desc.value=d.className;rte.makeDocumentEditable(true);}}function reStampStationery(h,g){if(document.getElementById("compose_editorArea").tagName!="IFRAME"){return;}var j=document.getElementById("compose_editorArea").contentWindow.document;var d=j.body;if(typeof d!=="undefined"&&d!==null){d.style.backgroundImage=(g.backgroundURL!="")?"url('"+g.backgroundURL+"')":"";var c=g.styles.split(";");var f=c.length;for(var b=0;b<f;b++){var a=c[b].split(":");switch(a[0]){case"color":d.style.color=(a[1])?a[1]:"";break;case"font-family":d.style.fontFamily=(a[1])?a[1]:"";break;case"background-color":d.style.backgroundColor=(a[1])?a[1]:"";break;}}}}function onToClick(a){YUtil.Event.preventDefault(a);rs("pab",MC.Compose.globals.kioskULTURL,500,480,0);}function showCancelConfirmation(d){var b=YDom.get;var c=MC.Compose;if(!c.globals.quota_exceeded){var f=false;if(b("to").value!==""){f=true;}else{if(b("cc").value!==""){f=true;}else{if(b("bcc").value!==""){f=true;}else{if(b("Subj").value!==""){f=true;}else{if(typeof rte!=="undefined"&&rte!==null){if(rte.getEditorContent().replace(/<br(.*)>/,"")!==""){f=true;}}else{if(b("compose_editorArea").value!==""){f=true;}else{var a=b("attachments");if(typeof a!=="undefined"&&a!==null&&a.value!==""){f=true;}}}}}}}if(f&&!confirm(c.uiStrings.CANCEL_WARNING)){YUtil.Event.preventDefault(d);}}}function findEmailsInAddressBook(g){var d={},c;if(MAB){var e=MAB.results;for(c in e){d[e[c][0].toLowerCase()]=true;}}var f={},a=g.length;if(a>0){for(c=0;c<a;++c){var b=g[c].toLowerCase();f[b]=(d[b])?true:false;}}return f;}function checkEmailExistence(l){var p=YLang.JSON;var b=document.getElementById("to").value+",";b+=document.getElementById("cc").value+",";b+=document.getElementById("bcc").value+",";b=b.replace(/;/g,",");var c=b.split(",");var j=new RegExp(/([^@ ;<>"]+@[^@ ;<>"]+\.[^@ ;<>"]+)/);var n=[];var k=c.length;for(var h=0,a=0;h<k;h++){var m=c[h];var g=m.match(j);if(g===null||g[1]===undefined||g[1]===null||g[1]===""){continue;}n[a++]=g[1];}document.getElementById("jsonEmails").value=p.stringify(findEmailsInAddressBook(n));var f=document.getElementById("Compose")||document.forms.Compose;if(MC.shortcuts.shiftKey){createHiddenEl("sp");}if(asyncMode){if(l){var o=YUtil.Event;o.preventDefault(l);MC.asyncManager.get(f.action+"&clean","compose",f);var d=MC.Compose.globals;if(d.disableButtons){for(i=0;i<d.disableBtnArray.length;i++){var q=document.getElementById(d.disableBtnArray[i]);q.className+=" buttondisabled";q.disabled="true";}}}}if(MC.Compose.globals.asTimer){clearTimeout(MC.Compose.globals.asTimer);MC.Compose.globals.asTimer=false;}}function adjustFieldHeight(d){if(!MC.Compose.globals.isOpera){var c=document.getElementById(d);var b=parseInt(c.style.height,10),a=YDom.setStyle;a(c.id,"overflow","hidden");if(c.scrollHeight>b){if(c.scrollHeight<102){c.style.height=c.scrollHeight+"px";a(c.id,"overflow-y","hidden");}else{c.style.height="102px";a(c.id,"overflow-y","scroll");}}}}function repTxtField(c){var a=document.getElementById(c);var b=a.parentNode;var d=document.createElement("textarea");d.name=a.name;d.id=a.id;d.className=a.className;d.setAttribute("autocomplete","off");d.tabIndex=a.tabIndex;d.value=a.value;d.style.height="19px";b.removeChild(a);b.appendChild(d);adjustFieldHeight(c);}function enhanceFields(){if(!MC.Compose.globals.isOpera){repTxtField("to");repTxtField("cc");repTxtField("bcc");YUtil.Event.on(["to","cc","bcc"],"keyup",chgFieldHeight);document.getElementById("Subj").style.height="19px";}changeABLinks("to");changeABLinks("cc");changeABLinks("bcc");}function entityDecode(a){return a.replace(/&quot;/g,'"').replace(/&#(0*)39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#(0*)92;/g,"\\").replace(/&amp;/g,"&");}function plainEntityDecode(a){return entityDecode(a).replace(/&nbsp;/g," ");}function stampSignature(f){var d=document.getElementById("signatureIndicator");if(!d){return false;}d.innerHTML="";var c=document.getElementById("defFromAddress");if(c){var b=c.value;var e=MC.Compose.signatures[b];}else{var e=MC.Compose.signatures[""];}if(e==""){return false;}else{d.innerHTML=MC.Compose.uiStrings.SIGNATURED;}var a=document.getElementById("compose_editorArea");if(a.tagName=="IFRAME"&&typeof rte!="undefined"){document.Compose.Content.value=rte.getEditorContent()+entityDecode(e);rte.setContent();}else{a.value=a.value+plainEntityDecode(e);}}function toggleStampSignatureButton(){var d=document.getElementById("defFromAddress");var a=document.getElementById("stampSignatureButton");if(a){var b="";if(d){b=d.value;}var e=MC.Compose.signatures[b];if(e!==""){a.disabled=false;a.style.color="black";}else{a.disabled=true;a.style.color="gray";}}var c=document.getElementById("signatureIndicator");if(c){c.innerHTML="";}}